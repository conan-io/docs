<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lockfiles &mdash; conan 2.13.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://docs.conan.io/tutorial/versioning/lockfiles.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f5edd4dd"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Dependencies conflicts" href="conflicts.html" />
    <link rel="prev" title="Revisions" href="revisions.html" />


<script
  data-cfasync="false"
  data-tracker-overrides="GoogleConsentMode:security_storage=on;ad_storage=SaleOfInfo,Advertising;ad_user_data=SaleOfInfo,Advertising;ad_personalization=SaleOfInfo,Advertising;analytics_storage=Analytics,SaleOfInfo;functionality_storage=Functional,SaleOfInfo;personalization_storage=Functional,SaleOfInfo"
  src="https://transcend-cdn.com/cm/f0071674-c641-4cf3-9d31-303ec0c86b1b/airgap.js" data-languages="en"
></script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://gtm.jfrog.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "GTM-WK44ZFM");
      gtag('set', 'developer_id.dODQ2Mj', true);
</script>

 



</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.13
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew.html">What‚Äôs new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../consuming_packages.html">Consuming packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../creating_packages.html">Creating packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conan_repositories.html">Working with Conan repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing_packages.html">Developing packages locally</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../versioning.html">Versioning</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="versions.html">Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="version_ranges.html">Version ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="revisions.html">Revisions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lockfiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="conflicts.html">Dependencies conflicts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../other_features.html">Other important Conan features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ci_tutorial/tutorial.html">CI Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/devops.html">Devops guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../incubating.html">Incubating features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div class="admonition warning wy-text-center" style="position:sticky;top:0;background: #fcfcfc;padding: inherit;z-index:1" id="conan-banners">
            
            <div style="border: 2px solid #4a7d7e; background-color: #e6f2f2; padding: 8px">
                <p>
                  üìñ The complete Conan 2 training is now available for free on
                  JFrog Academy: <a
                  href="https://academy.jfrog.com/path/conan-cc-package-manager?utm_source=Conan+Docs"
                  target="_blank">Essentials</a> and <a
                  href="https://academy.jfrog.com/path/conan-2-advanced?utm_source=Conan+Docs"
                  target="_blank">Advanced</a>.
                </p>
              </div>                                                  
          </div>
          
          <div>
            <div class="admonition warning wy-text-center" style="position:sticky">
              <p>This document is for an <b>outdated</b> Conan version.
              <a href="https://docs.conan.io/2/tutorial/versioning/lockfiles.html">Click here to read the <b>latest</b> documentation</a></p>
             </div>
          </div>
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorial.html">Tutorial</a></li>
          <li class="breadcrumb-item"><a href="../versioning.html">Versioning</a></li>
      <li class="breadcrumb-item active">Lockfiles</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lockfiles">
<span id="tutorial-versioning-lockfiles"></span><h1>Lockfiles<a class="headerlink" href="#lockfiles" title="Link to this heading">¬∂</a></h1>
<p>Lockfiles are a mechanism to achieve reproducible dependencies, even when new versions or revisions
of those dependencies are created.
Let‚Äôs see it with a practical example, start cloning  the <a class="reference external" href="https://github.com/conan-io/examples2">examples2 repository</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/tutorial/versioning/lockfiles/intro
</pre></div>
</div>
<p>In this folder we have a small project, consisting in 3 packages: a <code class="docutils literal notranslate"><span class="pre">matrix</span></code> package, emulating some mathematical
library, an <code class="docutils literal notranslate"><span class="pre">engine</span></code> package emulating some game engine, and a <code class="docutils literal notranslate"><span class="pre">sound32</span></code> package, emulating a sound library for
some 32bits systems. These packages are actually most empty, they do not build any code, but they are good to learn
the concepts of lockfiles.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-8af47a14c61e2c80a08970d1d53665718f3e52a4.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph lockfiles {
    node [fillcolor=&quot;lightskyblue&quot;, style=filled, shape=box]
    rankdir=&quot;BT&quot;
    &quot;engine/1.0&quot; -&gt; &quot;matrix/1.0&quot;;
    &quot;engine/1.0&quot; -&gt; &quot;sound32/1.0&quot; [label=&quot;if arch==x86&quot;];
}</p></object></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>We will start by creating the first <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>matrix<span class="w"> </span>--version<span class="o">=</span><span class="m">1</span>.0
</pre></div>
</div>
<p>Now we can check in the <code class="docutils literal notranslate"><span class="pre">engine</span></code> folder its recipe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Engine</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;engine&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;arch&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;matrix/[&gt;=1.0 &lt;2.0]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;x86&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;sound32/[&gt;=1.0 &lt;2.0]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Lets move to the <code class="docutils literal notranslate"><span class="pre">engine</span></code> folder and install its dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>engine
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.
...
Requirements
<span class="w">    </span>matrix/1.0#905c3f0babc520684c84127378fefdd0<span class="w"> </span>-<span class="w"> </span>Cache
Resolved<span class="w"> </span>version<span class="w"> </span>ranges
<span class="w">    </span>matrix/<span class="o">[</span>&gt;<span class="o">=</span><span class="m">1</span>.0<span class="w"> </span>&lt;<span class="m">2</span>.0<span class="o">]</span>:<span class="w"> </span>matrix/1.0
</pre></div>
</div>
<p>As the <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> version is in the valid range, it is resolved and used.
But if someone creates a new <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> or <code class="docutils literal notranslate"><span class="pre">1.X</span></code> version, it would also be automatically used, because
it is also in the valid range. To avoid this, we will capture a ‚Äúsnapshot‚Äù of the current dependencies
creating a <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> lockfile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>.
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;matrix/1.0#905c3f0babc520684c84127378fefdd0%1675278126.0552447&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>We can see how the created <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> lockfile contains the <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> version
and its revision. But <code class="docutils literal notranslate"><span class="pre">sound32/1.0</span></code> is not in the lockfile, because for the default
configuration profile (not <code class="docutils literal notranslate"><span class="pre">x86</span></code>), this <code class="docutils literal notranslate"><span class="pre">sound32</span></code> is not a dependency.</p>
<p>Now, a new <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> version is created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>matrix<span class="w"> </span>--version<span class="o">=</span><span class="m">1</span>.1
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>engine
</pre></div>
</div>
<p>And see what happens when we issue a new <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> command for the engine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.
<span class="c1"># equivalent to conan install . --lockfile=conan.lock</span>
...
Requirements
<span class="w">   </span>matrix/1.0#905c3f0babc520684c84127378fefdd0<span class="w"> </span>-<span class="w"> </span>Cache
</pre></div>
</div>
<p>As we can see, the new <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> was not used, even if it is in the valid range!
This happens because by default the <code class="docutils literal notranslate"><span class="pre">--lockfile=conan.lock</span></code> will be used if the
<code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> file is found. The locked <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> version and revision will be
used to resolve the range, and the <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> will be ignored.</p>
<p>Likewise, it is possible to issue other Conan commands, and if the <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> is there,
it will be used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>info<span class="w"> </span>.<span class="w"> </span>--filter<span class="o">=</span>requires<span class="w"> </span><span class="c1"># --lockfile=conan.lock is implicit</span>
<span class="c1"># display info for matrix/1.0</span>
$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--version<span class="o">=</span><span class="m">1</span>.0<span class="w"> </span><span class="c1"># --lockfile=conan.lock is implicit</span>
<span class="c1"># creates the engine/1.0 package, using matrix/1.0 as dependency</span>
</pre></div>
</div>
<p>If using a lockfile is intended, like in CI, it is better that the argument <code class="docutils literal notranslate"><span class="pre">--lockfile=conan.lock</span></code> explicit.</p>
<section id="multi-configuration-lockfiles">
<h2>Multi-configuration lockfiles<a class="headerlink" href="#multi-configuration-lockfiles" title="Link to this heading">¬∂</a></h2>
<p>We saw above that the <code class="docutils literal notranslate"><span class="pre">engine</span></code> has a conditional dependency to the <code class="docutils literal notranslate"><span class="pre">sound32</span></code> package, in case the architecture
is <code class="docutils literal notranslate"><span class="pre">x86</span></code>. That also means that such <code class="docutils literal notranslate"><span class="pre">sound32</span></code> package version was not captured in the above lockfile.</p>
<p>Lets create the <code class="docutils literal notranslate"><span class="pre">sound32/1.0</span></code> package first, then try to install <code class="docutils literal notranslate"><span class="pre">engine</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>sound32<span class="w"> </span>--version<span class="o">=</span><span class="m">1</span>.0
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>engine
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86<span class="w"> </span><span class="c1"># FAILS!</span>
ERROR:<span class="w"> </span>Requirement<span class="w"> </span><span class="s1">&#39;sound32/[&gt;=1.0 &lt;2.0]&#39;</span><span class="w"> </span>not<span class="w"> </span><span class="k">in</span><span class="w"> </span>lockfile
</pre></div>
</div>
<p>This happens because the <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> lockfile doesn‚Äôt contain a locked version for <code class="docutils literal notranslate"><span class="pre">sound32</span></code>. By default
lockfiles are strict, if we are locking dependencies, a matching version inside the lockfile must be found.
We can relax this assumption with the <code class="docutils literal notranslate"><span class="pre">--lockfile-partial</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86<span class="w"> </span>--lockfile-partial
...
Requirements
<span class="w">    </span>matrix/1.0#905c3f0babc520684c84127378fefdd0<span class="w"> </span>-<span class="w"> </span>Cache
<span class="w">    </span>sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7<span class="w"> </span>-<span class="w"> </span>Cache
Resolved<span class="w"> </span>version<span class="w"> </span>ranges
<span class="w">    </span>sound32/<span class="o">[</span>&gt;<span class="o">=</span><span class="m">1</span>.0<span class="w"> </span>&lt;<span class="m">2</span>.0<span class="o">]</span>:<span class="w"> </span>sound32/1.0
</pre></div>
</div>
<p>This will manage to partially lock to <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code>, and resolve <code class="docutils literal notranslate"><span class="pre">sound32</span></code> version range as usual.
But we can do better, we can extend our lockfile to also lock <code class="docutils literal notranslate"><span class="pre">sound32/1.0</span></code> version, to avoid
possible disruptions caused by new <code class="docutils literal notranslate"><span class="pre">sound32</span></code> unexpected versions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675278904.0791488&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.0#905c3f0babc520684c84127378fefdd0%1675278900.0103245&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, both <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> and <code class="docutils literal notranslate"><span class="pre">sound32/1.0</span></code> are locked inside our <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> lockfile.
It is possible to use this lockfile for both configurations (64bits, and x86 architectures),
having versions in a lockfile that are not used for a given configuration is not an issue,
as long as the necessary dependencies for that configuration find a matching version in it.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Lockfiles contains sorted lists of requirements, ordered by versions and revisions, so
latest versions and revisions are the ones that are prioritized when resolving against a lockfile.
A lockfile can contain two or more different versions of the same package, just because different
version ranges require them. The sorting will provide the right logic so each range resolves to
each valid versions.</p>
<p>If a version in the lockfile doesn‚Äôt fit in a valid range, it will not be used. It is not possible
for lockfiles to force a dependency that goes against what <code class="docutils literal notranslate"><span class="pre">conanfile</span></code> requires define, as they
are ‚Äúsnapshots‚Äù of an existing/realizable dependency graph, but cannot define an ‚Äúimpossible‚Äù
dependency graph.</p>
</div>
</section>
<section id="evolving-lockfiles">
<h2>Evolving lockfiles<a class="headerlink" href="#evolving-lockfiles" title="Link to this heading">¬∂</a></h2>
<p>Even if lockfiles enforce and constraint the versions that can be resolved for a graph, it doesn‚Äôt
mean that lockfiles cannot evolve. Actually, controlled evolution of lockfiles is paramount to
important processes like Continuous Integration, when the effect of one change in the graph wants
to be tested in isolation of other possible concurrent changes.</p>
<p>In this section we will introduce some of the basic functionality of lockfiles that allows such
evolution.</p>
<p>First, if we would like now to introduce and test the new <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> version in our <code class="docutils literal notranslate"><span class="pre">engine</span></code>,
without necessarily pulling many other dependencies that could have got new versions too, we could
manually add <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> to the lockfile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>Running:<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>add<span class="w"> </span>--requires<span class="o">=</span>matrix/1.1
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675278904.0791488&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.1&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.0#905c3f0babc520684c84127378fefdd0%1675278900.0103245&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To be clear: manually adding with <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">add</span></code> is not necessarily a recommended flow, it is
possible to automate the task with other approaches, that will be explained later. This is just
an introduction to the principles and concepts.</p>
<p>The important idea is that now we got 2 versions of <code class="docutils literal notranslate"><span class="pre">matrix</span></code> in the lockfile, and <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code>
is before <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code>, so for the range <code class="docutils literal notranslate"><span class="pre">matrix/[&gt;=1.0</span> <span class="pre">&lt;2.0]</span></code>, the first one (<code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code>)
would be prioritized. That means that when now the new lockfile is used, it will resolve to
<code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> version (even if a <code class="docutils literal notranslate"><span class="pre">matrix/1.2</span></code> or higher version existed in the system):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86<span class="w"> </span>--lockfile-out<span class="o">=</span>conan.lock
Requirements
<span class="w">    </span>matrix/1.1#905c3f0babc520684c84127378fefdd0<span class="w"> </span>-<span class="w"> </span>Cache
<span class="w">    </span>sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7<span class="w"> </span>-<span class="w"> </span>Cache
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675278904.0791488&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.1#905c3f0babc520684c84127378fefdd0%1675278901.7527816&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.0#905c3f0babc520684c84127378fefdd0%1675278900.0103245&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that now <code class="docutils literal notranslate"><span class="pre">matrix/1.1</span></code> was resolved, and it also got its <code class="docutils literal notranslate"><span class="pre">revision</span></code> stored in
the lockfile (because <code class="docutils literal notranslate"><span class="pre">--lockfile-out=conan.lock</span></code> was passed as argument).</p>
<p>It is true that the former <code class="docutils literal notranslate"><span class="pre">matrix/1.0</span></code> version was not used. As said above, having
old versions in the lockfile that are not used is not harmful. However, if we want to
prune the unused versions and revisions, we could use the <code class="docutils literal notranslate"><span class="pre">--lockfile-clean</span></code> for that
purpose:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86<span class="w"> </span>--lockfile-out<span class="o">=</span>conan.lock<span class="w"> </span>--lockfile-clean
...
Requirements
<span class="w">    </span>matrix/1.1#905c3f0babc520684c84127378fefdd0<span class="w"> </span>-<span class="w"> </span>Cache
<span class="w">    </span>sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7<span class="w"> </span>-<span class="w"> </span>Cache
...
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675278904.0791488&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.1#905c3f0babc520684c84127378fefdd0%1675278901.7527816&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>It is relevant to note that the <code class="docutils literal notranslate"><span class="pre">-lockfile-clean</span></code> could remove locked versions in
given configurations. For example, if instead of the above, the <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> architecture
is used, the <code class="docutils literal notranslate"><span class="pre">--lockfile-clean</span></code> will prune the ‚Äúunused‚Äù <code class="docutils literal notranslate"><span class="pre">sound32</span></code>, because in that
configuration is not used. It is possible to evaluate new lockfiles for every different
configuration, and then merge them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--lockfile-out<span class="o">=</span><span class="m">64</span>.lock<span class="w"> </span>--lockfile-clean
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>-s<span class="w"> </span><span class="nv">arch</span><span class="o">=</span>x86<span class="w"> </span>--lockfile-out<span class="o">=</span><span class="m">32</span>.lock<span class="w"> </span>--lockfile-clean
$<span class="w"> </span>cat<span class="w"> </span><span class="m">64</span>.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;matrix/1.1#905c3f0babc520684c84127378fefdd0%1675294635.6049662&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
$<span class="w"> </span>cat<span class="w"> </span><span class="m">32</span>.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675294637.9775107&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.1#905c3f0babc520684c84127378fefdd0%1675294635.6049662&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>merge<span class="w"> </span>--lockfile<span class="o">=</span><span class="m">32</span>.lock<span class="w"> </span>--lockfile<span class="o">=</span><span class="m">64</span>.lock<span class="w"> </span>--lockfile-out<span class="o">=</span>conan.lock
$<span class="w"> </span>cat<span class="w"> </span>conan.lock
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;0.5&quot;</span>,
<span class="w">    </span><span class="s2">&quot;requires&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;sound32/1.0#83d4b7bf607b3b60a6546f8b58b5cdd7%1675294637.9775107&quot;</span>,
<span class="w">        </span><span class="s2">&quot;matrix/1.1#905c3f0babc520684c84127378fefdd0%1675294635.6049662&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;build_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">    </span><span class="s2">&quot;python_requires&quot;</span>:<span class="w"> </span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This multiple-clean + merge operation is not something that developers should do, only CI
scripts, and for some advanced CI flows that will be explained later.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ci_tutorial/tutorial.html#ci-tutorial"><span class="std std-ref">CI tutorial</span></a>.</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="revisions.html" class="btn btn-neutral float-left" title="Revisions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="conflicts.html" class="btn btn-neutral float-right" title="Dependencies conflicts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">Last updated on Feb 25, 2026.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: 2.13
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
    <dt>Versions</dt>
    
        
            <dd><a href="/2.26/index.html">2.26</a></dd>
        
    
        
            <dd><a href="/2.25/index.html">2.25</a></dd>
        
    
        
            <dd><a href="/2.24/index.html">2.24</a></dd>
        
    
        
            <dd><a href="/2.23/index.html">2.23</a></dd>
        
    
        
            <dd><a href="/2.22/index.html">2.22</a></dd>
        
    
        
            <dd><a href="/2.21/index.html">2.21</a></dd>
        
    
        
            <dd><a href="/2.20/index.html">2.20</a></dd>
        
    
        
            <dd><a href="/2.19/index.html">2.19</a></dd>
        
    
        
            <dd><a href="/2.18/index.html">2.18</a></dd>
        
    
        
            <dd><a href="/2.17/index.html">2.17</a></dd>
        
    
        
            <dd><a href="/2.16/index.html">2.16</a></dd>
        
    
        
            <dd><a href="/2.15/index.html">2.15</a></dd>
        
    
        
            <dd><a href="/2.14/index.html">2.14</a></dd>
        
    
        
            <dd><a href="/2.13/index.html">2.13</a></dd>
        
    
        
            <dd><a href="/2.12/index.html">2.12</a></dd>
        
    
        
            <dd><a href="/2.11/index.html">2.11</a></dd>
        
    
        
            <dd><a href="/2.10/index.html">2.10</a></dd>
        
    
        
            <dd><a href="/2.9/index.html">2.9</a></dd>
        
    
        
            <dd><a href="/2.8/index.html">2.8</a></dd>
        
    
        
            <dd><a href="/2.7/index.html">2.7</a></dd>
        
    
        
            <dd><a href="/2.6/index.html">2.6</a></dd>
        
    
        
            <dd><a href="/2.5/index.html">2.5</a></dd>
        
    
        
            <dd><a href="/2.4/index.html">2.4</a></dd>
        
    
        
            <dd><a href="/2.3/index.html">2.3</a></dd>
        
    
        
            <dd><a href="/2.2/index.html">2.2</a></dd>
        
    
        
            <dd><a href="/2.1/index.html">2.1</a></dd>
        
    
        
            <dd><a href="/2.0/index.html">2.0</a></dd>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/2/index.html">2</a></dd>
        
    
    <br>
        <details>
            <summary>Conan 1 releases</summary>
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/1/index.html">1</a></dd>
        
    
        
            <dd><a href="/en/1.66/index.html">1.66</a></dd>
        
    
        
            <dd><a href="/en/1.65/index.html">1.65</a></dd>
        
    
        
            <dd><a href="/en/1.64/index.html">1.64</a></dd>
        
    
        
            <dd><a href="/en/1.63/index.html">1.63</a></dd>
        
    
        
            <dd><a href="/en/1.62/index.html">1.62</a></dd>
        
    
        
            <dd><a href="/en/1.61/index.html">1.61</a></dd>
        
    
        
            <dd><a href="/en/1.60/index.html">1.60</a></dd>
        
    
        
            <dd><a href="/en/1.59/index.html">1.59</a></dd>
        
    
        
            <dd><a href="/en/1.58/index.html">1.58</a></dd>
        
    
        
            <dd><a href="/en/1.57/index.html">1.57</a></dd>
        
    
        
            <dd><a href="/en/1.56/index.html">1.56</a></dd>
        
    
        
            <dd><a href="/en/1.55/index.html">1.55</a></dd>
        
    
        
            <dd><a href="/en/1.54/index.html">1.54</a></dd>
        
    
        
            <dd><a href="/en/1.53/index.html">1.53</a></dd>
        
    
        
            <dd><a href="/en/1.52/index.html">1.52</a></dd>
        
    
        
            <dd><a href="/en/1.51/index.html">1.51</a></dd>
        
    
        
            <dd><a href="/en/1.50/index.html">1.50</a></dd>
        
    
        
            <dd><a href="/en/1.49/index.html">1.49</a></dd>
        
    
        
            <dd><a href="/en/1.48/index.html">1.48</a></dd>
        
    
        
            <dd><a href="/en/1.47/index.html">1.47</a></dd>
        
    
        
            <dd><a href="/en/1.46/index.html">1.46</a></dd>
        
    
        
            <dd><a href="/en/1.45/index.html">1.45</a></dd>
        
    
        
            <dd><a href="/en/1.44/index.html">1.44</a></dd>
        
    
        
            <dd><a href="/en/1.43/index.html">1.43</a></dd>
        
    
        
            <dd><a href="/en/1.42/index.html">1.42</a></dd>
        
    
        
            <dd><a href="/en/1.41/index.html">1.41</a></dd>
        
    
        
            <dd><a href="/en/1.40/index.html">1.40</a></dd>
        
    
        
            <dd><a href="/en/1.39/index.html">1.39</a></dd>
        
    
        
            <dd><a href="/en/1.38/index.html">1.38</a></dd>
        
    
        
            <dd><a href="/en/1.37/index.html">1.37</a></dd>
        
    
        
            <dd><a href="/en/1.36/index.html">1.36</a></dd>
        
    
        
            <dd><a href="/en/1.35/index.html">1.35</a></dd>
        
    
        
            <dd><a href="/en/1.34/index.html">1.34</a></dd>
        
    
        
            <dd><a href="/en/1.33/index.html">1.33</a></dd>
        
    
        
            <dd><a href="/en/1.32/index.html">1.32</a></dd>
        
    
        
            <dd><a href="/en/1.31/index.html">1.31</a></dd>
        
    
        
            <dd><a href="/en/1.30/index.html">1.30</a></dd>
        
    
        
            <dd><a href="/en/1.29/index.html">1.29</a></dd>
        
    
        
            <dd><a href="/en/1.28/index.html">1.28</a></dd>
        
    
        
            <dd><a href="/en/1.27/index.html">1.27</a></dd>
        
    
        
            <dd><a href="/en/1.26/index.html">1.26</a></dd>
        
    
        
            <dd><a href="/en/1.25/index.html">1.25</a></dd>
        
    
        
            <dd><a href="/en/1.24/index.html">1.24</a></dd>
        
    
        
            <dd><a href="/en/1.23/index.html">1.23</a></dd>
        
    
        
            <dd><a href="/en/1.22/index.html">1.22</a></dd>
        
    
        
            <dd><a href="/en/1.21/index.html">1.21</a></dd>
        
    
        
            <dd><a href="/en/1.20/index.html">1.20</a></dd>
        
    
        
            <dd><a href="/en/1.19/index.html">1.19</a></dd>
        
    
        
            <dd><a href="/en/1.18/index.html">1.18</a></dd>
        
    
        
            <dd><a href="/en/1.17/index.html">1.17</a></dd>
        
    
        
            <dd><a href="/en/1.16/index.html">1.16</a></dd>
        
    
        
            <dd><a href="/en/1.15/index.html">1.15</a></dd>
        
    
        
            <dd><a href="/en/1.14/index.html">1.14</a></dd>
        
    
        
            <dd><a href="/en/1.13/index.html">1.13</a></dd>
        
    
        
            <dd><a href="/en/1.12/index.html">1.12</a></dd>
        
    
        
            <dd><a href="/en/1.11/index.html">1.11</a></dd>
        
    
        
            <dd><a href="/en/1.10/index.html">1.10</a></dd>
        
    
        
            <dd><a href="/en/1.9/index.html">1.9</a></dd>
        
    
        
            <dd><a href="/en/1.8/index.html">1.8</a></dd>
        
    
        
            <dd><a href="/en/1.7/index.html">1.7</a></dd>
        
    
        
            <dd><a href="/en/1.6/index.html">1.6</a></dd>
        
    
        
            <dd><a href="/en/1.5/index.html">1.5</a></dd>
        
    
        
            <dd><a href="/en/1.4/index.html">1.4</a></dd>
        
    
        
            <dd><a href="/en/1.3/index.html">1.3</a></dd>
        
    
        
    
        </details>
    </dl>
    <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/2.13/conan.pdf">PDF</a></dd>
        
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

<noscript><iframe src="https://gtm.jfrog.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>