<html>
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
    <link href="search.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
</head>

    <body>
    <select id="search" name="state" style="width:50%" multiple="1" onchange="window.location = this.value;">
    </select>


    <script>
        function decorateResult(result) {
          if(result.parent_title == null){
            return "";
          }
          var $ret = $('<div class="res_section"><span>' + result.parent_title + '</span><div class="res_subsection">' + result.title + '</div><div class="res_text">' + "text alshdlakjshdals ljhalskjdha aljsdh" + '</div>');
          return $ret;
        };



        var version = "1.15";
        var keywords = "missing";
        $(document).ready(function() {

            $('#search').select2({
              templateResult: decorateResult,
              ajax: {
                method: "GET",
                url: 'http://localhost:8001/search',
                data: function (params) {
                      var query = {
                        query: params.term,
                        version: version
                       }
                       return query;
                    },
                async: false,
                crossDomain: true,
                contentType: 'application/json',
                processResults: function (data) {
                  // Tranforms the top-level key of the response object from 'items' to 'results'
                  var elements = []
                  data.hits.forEach(function(el) {
                     if(el._score == 0){
                        return;
                     }
                     var tmp = el._source;
                     tmp.id = el._source.slug;
                     tmp.text = el._source.title;
                     if(!el._source.parent_title){
                        el._source.parent_title = tmp.text;
                     }
                     elements.push(tmp);
                  });
                  return {
                    results: elements
                  };
                }
              }
            });
        });
    </script>
    </body>


</html>