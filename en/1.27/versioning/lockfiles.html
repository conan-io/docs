<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lockfiles &mdash; conan 1.27.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://docs.conan.io/en/latest/versioning/lockfiles.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=004d8020"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mastering Conan" href="../mastering.html" />
    <link rel="prev" title="Package Revisions" href="revisions.html" />


<script
  data-cfasync="false"
  data-tracker-overrides="GoogleConsentMode:security_storage=on;ad_storage=SaleOfInfo,Advertising;ad_user_data=SaleOfInfo,Advertising;ad_personalization=SaleOfInfo,Advertising;analytics_storage=Analytics,SaleOfInfo;functionality_storage=Functional,SaleOfInfo;personalization_storage=Functional,SaleOfInfo"
  src="https://transcend-cdn.com/cm/f0071674-c641-4cf3-9d31-303ec0c86b1b/airgap.js" data-languages="en"
></script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://gtm.jfrog.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "GTM-WK44ZFM");
      gtag('set', 'developer_id.dODQ2Mj', true);
</script>

 



</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/conan-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.27
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uploading_packages.html">Uploading Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../versioning.html">Versioning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction to versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="version_ranges.html">Version ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="revisions.html">Package Revisions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Lockfiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-lockfiles">Using lockfiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-lockfiles-in-ci">How to use lockfiles in CI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mastering.html">Mastering Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">Howtos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conan_v2.html">Road to Conan 2.0</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div class="admonition warning wy-text-center" style="position:sticky;top:0;background: #fcfcfc;padding: inherit;z-index:1" id="conan-banners">
            
            <div style="border: 2px solid #eb8484;background-color: #ffcaca;padding: 3px;margin-bottom: 5px">
              <p>This document is for a <b>"1.X" legacy</b> Conan version, <b>which is no longer recommended</b>. Please update to Conan 2, <a href="https://docs.conan.io/2/">click here to read the <b>Conan 2</b> documentation</a></p>
            </div>
            
            <div style="border: 2px solid #4a7d7e; background-color: #e6f2f2; padding: 8px">
                <p>
                  üìñ The complete Conan 2 training is now available for free on
                  JFrog Academy: <a
                  href="https://academy.jfrog.com/path/conan-cc-package-manager?utm_source=Conan+Docs"
                  target="_blank">Essentials</a> and <a
                  href="https://academy.jfrog.com/path/conan-2-advanced?utm_source=Conan+Docs"
                  target="_blank">Advanced</a>.
                </p>
              </div>                                                  
          </div>
          <!--@ OUTDATED_VERSION_PLACEHOLDER_BEGIN @
          <div>
            <div class="admonition warning wy-text-center" style="position:sticky">
              <p>This document is for an <b>outdated</b> Conan version.
              <a href="https://docs.conan.io/2/@LATEST_DOC_PAGE_URL@">Click here to read the <b>latest</b> documentation</a></p>
             </div>
          </div>
          @ OUTDATED_VERSION_PLACEHOLDER_END @-->
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../versioning.html">Versioning</a></li>
      <li class="breadcrumb-item active">Lockfiles</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lockfiles">
<span id="versioning-lockfiles"></span><h1>Lockfiles<a class="headerlink" href="#lockfiles" title="Link to this heading">ÔÉÅ</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an <strong>experimental</strong> feature subject to breaking changes in future releases.</p>
</div>
<p>Lockfiles are files that store the information of a dependency graph, including the
exact versions, revisions, options, and configuration of that dependency graph. As
they depend on the configuration, and the dependency graph can change with every
different configuration, there will be one lockfile for every configuration.</p>
<p>Lockfiles are useful for achieving deterministic builds, even if the dependency
definitions in conanfile recipes are not fully deterministic, for example when using
version ranges or using package revisions.</p>
<p>Let‚Äôs say we have 3 package recipes <code class="docutils literal notranslate"><span class="pre">pkgc</span></code>, <code class="docutils literal notranslate"><span class="pre">pkgb</span></code>, and <code class="docutils literal notranslate"><span class="pre">pkga</span></code>, that define this dependency graph:</p>
<img alt="../_images/conan-graph_not_deterministic.png" src="../_images/conan-graph_not_deterministic.png" />
<p>The first time, when a <strong class="command">conan install .</strong> is executed, the requirement defined
in <code class="docutils literal notranslate"><span class="pre">pkgb</span></code> is resolved to <strong>pkga/1.0</strong>, because that was the latest at that time that
satisfied the version range <code class="docutils literal notranslate"><span class="pre">pkga/[*]</span></code>. After such install, the user can build and
run an application in the source code of <code class="docutils literal notranslate"><span class="pre">pkgc</span></code>. But some time later, another colleague
tries to do exactly the same, and suddenly it is pulling a newer version of <code class="docutils literal notranslate"><span class="pre">pkga</span></code> that
was recently published, getting different results (maybe even not working). Builds with
version ranges are not reproducible by default.</p>
<section id="using-lockfiles">
<h2>Using lockfiles<a class="headerlink" href="#using-lockfiles" title="Link to this heading">ÔÉÅ</a></h2>
<p>Lockfiles solve this problem creating a file that stores this information. In the example
above, the first <strong class="command">conan install .</strong> will generate a <em>conan.lock</em> file that can be
used later:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>PkgC
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w">  </span><span class="c1"># generates conan.lock</span>
<span class="c1"># After PkgA/1.1 has been created</span>
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>--lockfile<span class="w"> </span><span class="c1"># uses the existing conan.lock</span>
</pre></div>
</div>
<p>The second time that <strong class="command">conan install . --lockfile</strong> is called, with the lockfile argument
it will load the previously generated <em>conan.lock</em> file, that contains the information that
<code class="docutils literal notranslate"><span class="pre">pkga/1.0</span></code> is used, and will apply it again to the dependency resolution, resolving exactly
the same dependency graph:</p>
<img alt="../_images/conan-graph_locked.png" src="../_images/conan-graph_locked.png" />
<p>The <em>conan.lock</em> file contains more information than the versions of the dependencies, it contains:</p>
<ul class="simple">
<li><p>The ‚Äúeffective‚Äù profile that has been used to compute this lockfile. The effective profile is the
combination of the profile files that could have been passed in the command line, plus any
other settings or options directly defined in the command line.</p></li>
<li><p>It encodes a graph, not just a list of versions, as different nodes in the graph might be using
different versions too.</p></li>
<li><p>The options values at each package. As downstream consumers can define options values, it is
important that this information is also stored, so it is also possible to build intermediate nodes
of the graph leading to the same result.</p></li>
<li><p>Another kind of requirements like python_requires.</p></li>
</ul>
<p>Again, it is important to remember that every different configuration will generate a different
graph, and then a different <em>conan.lock</em> as result. So the example above would be more like the
following if we wanted to work with different configurations (e.g. Debug/Release):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>PkgC
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>release
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>..<span class="w"> </span><span class="c1"># generates conan.lock (release) in this folder</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../debug
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>..<span class="w"> </span>-s<span class="w"> </span><span class="nv">build_type</span><span class="o">=</span>Debug<span class="w"> </span><span class="c1"># generates conan.lock (debug)</span>
<span class="c1"># After PkgA/1.1 has been created</span>
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>..<span class="w"> </span>--lockfile<span class="w"> </span><span class="c1"># uses the existing conan.lock (debug)</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../release
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>..<span class="w"> </span>--lockfile<span class="w"> </span><span class="c1"># uses the existing conan.lock (release)</span>
</pre></div>
</div>
</section>
<section id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Link to this heading">ÔÉÅ</a></h2>
<p>There are 2 main entry points for lockfile information in conan commands:</p>
<ul>
<li><p><strong class="command">--lockfile</strong> argument in <strong class="command">install/create/export/info</strong></p>
<blockquote>
<div><p>If the command builds a package, it can modify its reference. Even if the version is not changed,
if something in the recipe changes, it will get a new recipe revision RREV and if the package is
built from sources again, it might end with a new, different package revision PREV. Those changes
will be updated in the <em>conan.lock</em> lockfile, and the package will be marked as ‚Äúmodified‚Äù.</p>
</div></blockquote>
</li>
<li><p><strong class="command">conan graph</strong> command</p>
<blockquote>
<div><p>This command group contains several functions related to the management of lockfiles:</p>
<ul>
<li><p><strong class="command">conan graph lock</strong></p>
<blockquote>
<div><p>This command will generate a <em>conan.lock</em> file. It behaves like <strong class="command">conan install</strong> command,
(this will also generate a lockfile by default), but without needing to actually install the
binaries, so it will be faster. In that regard, it is equal to <strong class="command">conan info</strong> that can also
generate a lockfile, but the problem with <strong class="command">conan info -if=.</strong> is that it does not allow to
specify a profile or settings.</p>
</div></blockquote>
</li>
<li><p><strong class="command">conan graph clean-modified</strong></p>
<blockquote>
<div><p>When a <strong class="command">conan create</strong> command that uses a lockfile builds a new binary, its reference
will change. This change, typically in the form of a recipe revision and/or package revision
is updated in the lockfile and the node is marked as ‚Äúmodified‚Äù. This <strong class="command">clean-modified</strong>
removes these ‚Äúmodified‚Äù flags from a lockfile. This operation is typically needed before starting
the build of a package in a locked graph, to know exactly which nodes have been modified by this
operation.</p>
</div></blockquote>
</li>
<li><p><strong class="command">conan graph update-lock</strong></p>
<blockquote>
<div><p>Update the current lockfile with the information of the second lockfile. Only the nodes marked
as ‚Äúmodified‚Äù will be updated. Trying to update to the current lockfile one node that has already
been ‚Äúmodified‚Äù will result in an error.</p>
</div></blockquote>
</li>
<li><p><strong class="command">conan graph build-order</strong></p>
<blockquote>
<div><p>Takes a lockfile as an argument, and return a list of lists indicating the order in which packages
in the graph have to be built. It only returns those packages that really need to be built,
following the <strong class="command">--build</strong> arguments and the <code class="docutils literal notranslate"><span class="pre">package_id()</span></code> rules.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For more information see <a class="reference internal" href="../reference/commands.html#commands"><span class="std std-ref">Commands</span></a></p>
</section>
<section id="how-to-use-lockfiles-in-ci">
<h2>How to use lockfiles in CI<a class="headerlink" href="#how-to-use-lockfiles-in-ci" title="Link to this heading">ÔÉÅ</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The code used in this section, including a <em>build.py</em> script to reproduce it, is in the
examples repository: <a class="reference external" href="https://github.com/conan-io/examples">https://github.com/conan-io/examples</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>features/lockfiles/ci
$<span class="w"> </span>python<span class="w"> </span>build.py
</pre></div>
</div>
</div>
<p>One of the applications of lockfiles is to be able to propagate changes in one package
belonging to a dependency graph downstream its affected consumers.</p>
<p>Lets say that we have the following project in which packages <code class="docutils literal notranslate"><span class="pre">pkga</span></code>, <code class="docutils literal notranslate"><span class="pre">pkgb</span></code>, <code class="docutils literal notranslate"><span class="pre">pkgc</span></code>, <code class="docutils literal notranslate"><span class="pre">pkgz</span></code> and <code class="docutils literal notranslate"><span class="pre">app</span></code>
have already been created and only one version of each, the version 0.1 exists. All packages
are using version ranges with a range like <code class="docutils literal notranslate"><span class="pre">pkgz/[&gt;0.0]</span></code>, so basically they will resolve to
any new version of their dependencies that it is published.</p>
<p>Also, the <code class="docutils literal notranslate"><span class="pre">full_version_mode</span></code> will be defined for dependencies. This means that if the version
number of one package dependencies change, then it will require a new binary. This assumption
is reasonable, as PkgA, PkgZ are header only libraries and PkgB and PkgC are static libraries
that inline functionality defined in PkgA and PkgZ. No matter what the changes in PkgA and PkgZ
are in new versions, it will be necessary to build new binaries for the downstream consumers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>general.default_package_id_mode<span class="o">=</span>full_version_mode
</pre></div>
</div>
<p>Now, some developer does some changes to PkgA, and do a pull request to the develop branch,
and we want our CI to build the new binaries for the dependants packages, down to the final
application App, to make sure that every works as expected.</p>
<p>The process starts generating a <em>conan.lock</em> lockfile in the <em>release</em> subfolder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>lock<span class="w"> </span>app/0.1@user/testing<span class="w"> </span>--lockfile<span class="o">=</span>release
</pre></div>
</div>
<p>This lockfile will contain the resolved dependencies in the graph, as we only have one version
0.1 for all the packages, all of them will be locked to that 0.1 version.</p>
<img alt="../_images/conan-lockfile_ci_1.png" src="../_images/conan-lockfile_ci_1.png" />
<p>Once the lockfile has been generated, it doesn‚Äôt matter if new, unrelated versions of other
packages, like <strong>pkgz/0.2</strong> is created with <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">pkgz</span> <span class="pre">&amp;&amp;</span> <span class="pre">conan</span> <span class="pre">create</span> <span class="pre">.</span> <span class="pre">pkgz/0.2&#64;user/testing</span></code></p>
<p>Now we can safely create the new version of <strong>pkga/0.2</strong>, that will resolve to use <strong>pkgz/0.1</strong>
instead of the latest 0.2, if we use the lockfile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>pkga<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>pkga/0.2@user/testing<span class="w"> </span>--lockfile<span class="o">=</span>../release
<span class="c1"># lockfile in release/conan.lock is modified to contain pkga/0.2</span>
</pre></div>
</div>
<p>Note that the lockfile is modified, to contain the new <strong>pkga/0.2</strong> version.</p>
<p>The next step is to know which dependents need to be built because they are affected by the new
<strong>pkga/0.2</strong> version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>./release<span class="w"> </span>--json<span class="o">=</span>bo.json<span class="w"> </span>--build<span class="o">=</span>missing
<span class="o">[[</span>PkgC,<span class="w"> </span>PkgD<span class="o">]</span>,<span class="w"> </span><span class="o">[</span>App<span class="o">]]</span><span class="w">  </span><span class="c1"># simplified format</span>
</pre></div>
</div>
<p>This command will return a list of lists, in order, of those packages to be built. It will be
stored in a <em>bo.json</em> json file too. Note that the <code class="docutils literal notranslate"><span class="pre">--build=missing</span></code> follows the same rules
as <strong class="command">create</strong> and <strong class="command">install</strong> commands. The result of evaluating the graph with
the <strong>pkga/0.2</strong> version, due to the <code class="docutils literal notranslate"><span class="pre">full_version_mode</span></code> policy is that new binaries for
PkgB, PkgC and App are necessary, and they do not exist yet. If we don‚Äôt provide the <code class="docutils literal notranslate"><span class="pre">--build=missing</span></code>
it will return an empty list (but it will fail later, because binary packages are not available).</p>
<p>We can now proceed iteratively with the following procedure:</p>
<ol class="arabic">
<li><p>pop the first element of the first sublist of the build order result, get its <code class="docutils literal notranslate"><span class="pre">ref</span></code> reference</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">build_order</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>allocate some resource, like a CI build server, or create a temporary folder.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>build_server_folder<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>build_server_folder/release
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>copy the lockfile to that resource (and move to it)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>release/conan.lock<span class="w"> </span>build_server_folder/release
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build_server_folder
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>build the package</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>&lt;ref&gt;<span class="w"> </span>--build<span class="o">=</span>&lt;ref&gt;<span class="w"> </span>--lockfile<span class="o">=</span>release
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>go back to the parent, update the lockfile with the changes</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>update-lock<span class="w"> </span>release<span class="w"> </span>build_server_folder/release
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build_server_folder
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>compute again the build-order of packages, if not empty, goto 1</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>./release<span class="w"> </span>--json<span class="o">=</span>bo.json<span class="w"> </span>--build<span class="o">=</span>missing
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>clean ‚Äúmodified‚Äù nodes from the lockfile</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>clean-modified<span class="w"> </span>release/
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>Note that this is a suboptimal approach, in order to explain the functionality, which
is more easy to follow if it is sequential. In reality, the CI can take the first
sublist output of <strong class="command">conan graph build-order</strong> and fire all its packages in parallel,
because they are guaranteed to be independent. Then, as soon as they start finishing and
build servers become available, the <strong class="command">conan graph build-order</strong> can be reevaluated,
and new builds can be launched accordingly, just taking care of not re-launching the same
build again. Note that the result of build-order contains a unique UUID, which is the identifier
of the node in the graph, which could be useful to dissambiguate.</p>
<img alt="../_images/conan-lockfile_ci_2.png" src="../_images/conan-lockfile_ci_2.png" />
<p>With this later approach, a deterministic build with optimal Continuous Integration process
with optimal utilization of resources and minimizing unnecessary rebuilds is achieved.</p>
<p>Note that this example has been using incremental versions and version ranges.
With package revisions it is also possible to achieve the same flow without bumping the versions and using fixed version dependencies:</p>
<ul class="simple">
<li><p>It will not be necessary to change the recipes or even to inject the values in CI.
Every change in a recipe will produce a new different recipe revision.</p></li>
<li><p>Revisions are also locked in lockfiles.</p></li>
<li><p>As revisions are resolved by default to latest, and the conan cache can only hold
one revision, it might be necessary to pass <code class="docutils literal notranslate"><span class="pre">--update</span></code> argument so the correct revision is updated in the cache.</p></li>
<li><p>It is necessary to define the <code class="docutils literal notranslate"><span class="pre">recipe_revision_mode</span></code> or the <code class="docutils literal notranslate"><span class="pre">package_revision_mode</span></code> if we want to guarantee that the binaries correctly model the dependencies changes.</p></li>
</ul>
<p>For implementing this flow, it might be necessary to share the different <code class="docutils literal notranslate"><span class="pre">conan.lock</span></code> lockfiles among different machines, to pass them to build servers. A git repo could be used, but also an Artifactory generic repository could be very convenient for this purpose.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a <strong>very experimental, temporary</strong> configuration (<code class="docutils literal notranslate"><span class="pre">general.relax_lockfile</span></code>), that allows to expand dependency
graphs with packages that are not in the lockfile. This scenario happens for example when a <code class="docutils literal notranslate"><span class="pre">test_package/conanfile.py</span></code> contains
other requirements. If the lockfile was built from another downstream consumer, the <code class="docutils literal notranslate"><span class="pre">test_package</span></code> and its requirements will
not be contained in the lockfile. But we might still want to do a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> for that node of the graph.
Putting the <code class="docutils literal notranslate"><span class="pre">general.relax_lockfile=1</span></code> will allow this case. This is a temporary thing introduced at 1.23, will be removed in future versions
(while probably leaving the behavior in some of its forms)</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="revisions.html" class="btn btn-neutral float-left" title="Package Revisions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../mastering.html" class="btn btn-neutral float-right" title="Mastering Conan" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2019, JFrog.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: 1.27
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
    <dt>Versions</dt>
    
        
            <dd><a href="/2.26/index.html">2.26</a></dd>
        
    
        
            <dd><a href="/2.25/index.html">2.25</a></dd>
        
    
        
            <dd><a href="/2.24/index.html">2.24</a></dd>
        
    
        
            <dd><a href="/2.23/index.html">2.23</a></dd>
        
    
        
            <dd><a href="/2.22/index.html">2.22</a></dd>
        
    
        
            <dd><a href="/2.21/index.html">2.21</a></dd>
        
    
        
            <dd><a href="/2.20/index.html">2.20</a></dd>
        
    
        
            <dd><a href="/2.19/index.html">2.19</a></dd>
        
    
        
            <dd><a href="/2.18/index.html">2.18</a></dd>
        
    
        
            <dd><a href="/2.17/index.html">2.17</a></dd>
        
    
        
            <dd><a href="/2.16/index.html">2.16</a></dd>
        
    
        
            <dd><a href="/2.15/index.html">2.15</a></dd>
        
    
        
            <dd><a href="/2.14/index.html">2.14</a></dd>
        
    
        
            <dd><a href="/2.13/index.html">2.13</a></dd>
        
    
        
            <dd><a href="/2.12/index.html">2.12</a></dd>
        
    
        
            <dd><a href="/2.11/index.html">2.11</a></dd>
        
    
        
            <dd><a href="/2.10/index.html">2.10</a></dd>
        
    
        
            <dd><a href="/2.9/index.html">2.9</a></dd>
        
    
        
            <dd><a href="/2.8/index.html">2.8</a></dd>
        
    
        
            <dd><a href="/2.7/index.html">2.7</a></dd>
        
    
        
            <dd><a href="/2.6/index.html">2.6</a></dd>
        
    
        
            <dd><a href="/2.5/index.html">2.5</a></dd>
        
    
        
            <dd><a href="/2.4/index.html">2.4</a></dd>
        
    
        
            <dd><a href="/2.3/index.html">2.3</a></dd>
        
    
        
            <dd><a href="/2.2/index.html">2.2</a></dd>
        
    
        
            <dd><a href="/2.1/index.html">2.1</a></dd>
        
    
        
            <dd><a href="/2.0/index.html">2.0</a></dd>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/2/index.html">2</a></dd>
        
    
    <br>
        <details>
            <summary>Conan 1 releases</summary>
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/1/index.html">1</a></dd>
        
    
        
            <dd><a href="/en/1.66/index.html">1.66</a></dd>
        
    
        
            <dd><a href="/en/1.65/index.html">1.65</a></dd>
        
    
        
            <dd><a href="/en/1.64/index.html">1.64</a></dd>
        
    
        
            <dd><a href="/en/1.63/index.html">1.63</a></dd>
        
    
        
            <dd><a href="/en/1.62/index.html">1.62</a></dd>
        
    
        
            <dd><a href="/en/1.61/index.html">1.61</a></dd>
        
    
        
            <dd><a href="/en/1.60/index.html">1.60</a></dd>
        
    
        
            <dd><a href="/en/1.59/index.html">1.59</a></dd>
        
    
        
            <dd><a href="/en/1.58/index.html">1.58</a></dd>
        
    
        
            <dd><a href="/en/1.57/index.html">1.57</a></dd>
        
    
        
            <dd><a href="/en/1.56/index.html">1.56</a></dd>
        
    
        
            <dd><a href="/en/1.55/index.html">1.55</a></dd>
        
    
        
            <dd><a href="/en/1.54/index.html">1.54</a></dd>
        
    
        
            <dd><a href="/en/1.53/index.html">1.53</a></dd>
        
    
        
            <dd><a href="/en/1.52/index.html">1.52</a></dd>
        
    
        
            <dd><a href="/en/1.51/index.html">1.51</a></dd>
        
    
        
            <dd><a href="/en/1.50/index.html">1.50</a></dd>
        
    
        
            <dd><a href="/en/1.49/index.html">1.49</a></dd>
        
    
        
            <dd><a href="/en/1.48/index.html">1.48</a></dd>
        
    
        
            <dd><a href="/en/1.47/index.html">1.47</a></dd>
        
    
        
            <dd><a href="/en/1.46/index.html">1.46</a></dd>
        
    
        
            <dd><a href="/en/1.45/index.html">1.45</a></dd>
        
    
        
            <dd><a href="/en/1.44/index.html">1.44</a></dd>
        
    
        
            <dd><a href="/en/1.43/index.html">1.43</a></dd>
        
    
        
            <dd><a href="/en/1.42/index.html">1.42</a></dd>
        
    
        
            <dd><a href="/en/1.41/index.html">1.41</a></dd>
        
    
        
            <dd><a href="/en/1.40/index.html">1.40</a></dd>
        
    
        
            <dd><a href="/en/1.39/index.html">1.39</a></dd>
        
    
        
            <dd><a href="/en/1.38/index.html">1.38</a></dd>
        
    
        
            <dd><a href="/en/1.37/index.html">1.37</a></dd>
        
    
        
            <dd><a href="/en/1.36/index.html">1.36</a></dd>
        
    
        
            <dd><a href="/en/1.35/index.html">1.35</a></dd>
        
    
        
            <dd><a href="/en/1.34/index.html">1.34</a></dd>
        
    
        
            <dd><a href="/en/1.33/index.html">1.33</a></dd>
        
    
        
            <dd><a href="/en/1.32/index.html">1.32</a></dd>
        
    
        
            <dd><a href="/en/1.31/index.html">1.31</a></dd>
        
    
        
            <dd><a href="/en/1.30/index.html">1.30</a></dd>
        
    
        
            <dd><a href="/en/1.29/index.html">1.29</a></dd>
        
    
        
            <dd><a href="/en/1.28/index.html">1.28</a></dd>
        
    
        
            <dd><a href="/en/1.27/index.html">1.27</a></dd>
        
    
        
            <dd><a href="/en/1.26/index.html">1.26</a></dd>
        
    
        
            <dd><a href="/en/1.25/index.html">1.25</a></dd>
        
    
        
            <dd><a href="/en/1.24/index.html">1.24</a></dd>
        
    
        
            <dd><a href="/en/1.23/index.html">1.23</a></dd>
        
    
        
            <dd><a href="/en/1.22/index.html">1.22</a></dd>
        
    
        
            <dd><a href="/en/1.21/index.html">1.21</a></dd>
        
    
        
            <dd><a href="/en/1.20/index.html">1.20</a></dd>
        
    
        
            <dd><a href="/en/1.19/index.html">1.19</a></dd>
        
    
        
            <dd><a href="/en/1.18/index.html">1.18</a></dd>
        
    
        
            <dd><a href="/en/1.17/index.html">1.17</a></dd>
        
    
        
            <dd><a href="/en/1.16/index.html">1.16</a></dd>
        
    
        
            <dd><a href="/en/1.15/index.html">1.15</a></dd>
        
    
        
            <dd><a href="/en/1.14/index.html">1.14</a></dd>
        
    
        
            <dd><a href="/en/1.13/index.html">1.13</a></dd>
        
    
        
            <dd><a href="/en/1.12/index.html">1.12</a></dd>
        
    
        
            <dd><a href="/en/1.11/index.html">1.11</a></dd>
        
    
        
            <dd><a href="/en/1.10/index.html">1.10</a></dd>
        
    
        
            <dd><a href="/en/1.9/index.html">1.9</a></dd>
        
    
        
            <dd><a href="/en/1.8/index.html">1.8</a></dd>
        
    
        
            <dd><a href="/en/1.7/index.html">1.7</a></dd>
        
    
        
            <dd><a href="/en/1.6/index.html">1.6</a></dd>
        
    
        
            <dd><a href="/en/1.5/index.html">1.5</a></dd>
        
    
        
            <dd><a href="/en/1.4/index.html">1.4</a></dd>
        
    
        
            <dd><a href="/en/1.3/index.html">1.3</a></dd>
        
    
        
    
        </details>
    </dl>
    <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/en/1.27/conan.pdf">PDF</a></dd>
        
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

<noscript><iframe src="https://gtm.jfrog.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>