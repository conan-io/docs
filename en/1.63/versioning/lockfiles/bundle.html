<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lockfile bundles &mdash; conan 1.63.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/conan.css?v=2e89a5c2" />

  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://docs.conan.io/versioning/lockfiles/bundle.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f309db74"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lockfiles in Continuous Integration" href="ci.html" />
    <link rel="prev" title="Build order in lockfiles" href="build_order.html" />


<script
  data-cfasync="false"
  data-tracker-overrides="GoogleConsentMode:security_storage=on;ad_storage=SaleOfInfo,Advertising;ad_user_data=SaleOfInfo,Advertising;ad_personalization=SaleOfInfo,Advertising;analytics_storage=Analytics,SaleOfInfo;functionality_storage=Functional,SaleOfInfo;personalization_storage=Functional,SaleOfInfo"
  src="https://transcend-cdn.com/cm/f0071674-c641-4cf3-9d31-303ec0c86b1b/airgap.js" data-languages="en"
></script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://gtm.jfrog.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "GTM-WK44ZFM");
      gtag('set', 'developer_id.dODQ2Mj', true);
</script>

 



</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/conan-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.63
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conan_v2.html">Conan migration guide to 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training_courses.html">Training Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uploading_packages.html">Uploading Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../versioning.html">Versioning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction to versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_ranges.html">Version ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../revisions.html">Package Revisions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../lockfiles.html">Lockfiles</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurations.html">Multiple configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="evolving.html">Evolving lockfiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_order.html">Build order in lockfiles</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lockfile bundles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-lockfile-bundle">Creating a lockfile bundle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-a-lockfile-bundle-to-build">Using a lockfile bundle to build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ci.html">Lockfiles in Continuous Integration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mastering.html">Mastering Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos.html">Howtos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div class="admonition warning wy-text-center" style="position:sticky;top:0;background: #fcfcfc;padding: inherit;z-index:1" id="conan-banners">
            
            <div style="border: 2px solid #eb8484;background-color: #ffcaca;padding: 3px;margin-bottom: 5px">
              <p>This document is for a <b>"1.X" legacy</b> Conan version, <b>which is no longer recommended</b>. Please update to Conan 2, <a href="https://docs.conan.io/2/">click here to read the <b>Conan 2</b> documentation</a></p>
            </div>
            
            <div style="border: 2px solid #4a7d7e; background-color: #e6f2f2; padding: 8px">
                <p>
                  📖 The Conan 2 essentials training is now available in the JFrog Academy for free.
                  <a href="https://academy.jfrog.com/conan-2-essentials?utm_source=Conan+Docs" target="_blank">Register now</a>.
                </p>
              </div>                                                  
          </div>
          <!--@ OUTDATED_VERSION_PLACEHOLDER_BEGIN @
          <div>
            <div class="admonition warning wy-text-center" style="position:sticky">
              <p>This document is for an <b>outdated</b> Conan version.
              <a href="https://docs.conan.io/2/@LATEST_DOC_PAGE_URL@">Click here to read the <b>latest</b> documentation</a></p>
             </div>
          </div>
          @ OUTDATED_VERSION_PLACEHOLDER_END @-->
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../versioning.html">Versioning</a></li>
          <li class="breadcrumb-item"><a href="../lockfiles.html">Lockfiles</a></li>
      <li class="breadcrumb-item active">Lockfile bundles</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/master/versioning/lockfiles/bundle.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lockfile-bundles">
<span id="versioning-lockfiles-bundle"></span><h1>Lockfile bundles<a class="headerlink" href="#lockfile-bundles" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an <strong>experimental</strong> feature subject to breaking changes in future releases.</p>
</div>
<p>Every package build using lockfiles requires a given configuration-specific lockfile, and after the build, that lockfile is
updated to include the built package revision. If we have different configurations for different variants as different architectures,
compiler versions or Debug/Release, a build will be typically necessary for each one.</p>
<p>In real life, it is also likely that we might want to build together different applications or products, that could be even disconnected,
and we want to do it as efficiently and fast (in parallel) as possible. We could have the following situation:</p>
<a class="reference internal image-reference" href="../../_images/conan_lock_bundle.png"><img alt="../../_images/conan_lock_bundle.png" class="align-center" src="../../_images/conan_lock_bundle.png" style="width: 400px; height: 200px;" /></a>
<p>In this diagram we see that we are building and releasing 2 different products in our team: <code class="docutils literal notranslate"><span class="pre">app1/1.1</span></code> and
<code class="docutils literal notranslate"><span class="pre">app2/2.3</span></code>. <code class="docutils literal notranslate"><span class="pre">app1</span></code> depends on <code class="docutils literal notranslate"><span class="pre">pkgb/0.1</span></code> (omitting <code class="docutils literal notranslate"><span class="pre">user/channel</span></code> for brevity, but please use it) and
<code class="docutils literal notranslate"><span class="pre">app2</span></code> depends on <code class="docutils literal notranslate"><span class="pre">pkgb/0.2</span></code>. In turn, both versions of <code class="docutils literal notranslate"><span class="pre">pkgb</span></code> depend on the same <code class="docutils literal notranslate"><span class="pre">pkga/0.1</span></code> version.</p>
<p>If we are building both products for 2 different configurations each (lets say Windows and Linux), we could capture 4
different lockfiles:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app1/1.1<span class="w"> </span>--base<span class="w"> </span>--lockfile-out<span class="o">=</span>app1_base.lock
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app2/2.3<span class="w"> </span>--base<span class="w"> </span>--lockfile-out<span class="o">=</span>app2_base.lock

$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app1/1.1<span class="w"> </span>-s<span class="w"> </span><span class="nv">os</span><span class="o">=</span>Windows<span class="w"> </span>--lockfile<span class="o">=</span>app1_base.lock<span class="w"> </span>--lockfile-out<span class="o">=</span>app1_windows.lock
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app1/1.1<span class="w"> </span>-s<span class="w"> </span><span class="nv">os</span><span class="o">=</span>Linux<span class="w">  </span>--lockfile<span class="o">=</span>app1_base.lock<span class="w"> </span>--lockfile-out<span class="o">=</span>app1_linux.lock
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app2/2.3<span class="w"> </span>-s<span class="w"> </span><span class="nv">os</span><span class="o">=</span>Windows<span class="w">  </span>--lockfile<span class="o">=</span>app2_base.lock<span class="w"> </span>--lockfile-out<span class="o">=</span>app2_windows.lock
$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>create<span class="w"> </span>--ref<span class="o">=</span>app2/2.3<span class="w"> </span>-s<span class="w"> </span><span class="nv">os</span><span class="o">=</span>Linux<span class="w">  </span>--lockfile<span class="o">=</span>app2_base.lock<span class="w"> </span>--lockfile-out<span class="o">=</span>app2_linux.lock
</pre></div>
</div>
<p>If we launched these 4 lockfiles builds in parallel, we can see that <code class="docutils literal notranslate"><span class="pre">pkga/0.1</span></code> will be built 4 times, 2 times
in Windows and 2 times in Linux. The extra build in each OS is redundant and can be avoided. But we need a way
to orchestrate it, that is what a lockfile bundle is for.</p>
<section id="creating-a-lockfile-bundle">
<h2>Creating a lockfile bundle<a class="headerlink" href="#creating-a-lockfile-bundle" title="Link to this heading"></a></h2>
<p>Creating a lockfile bundle can be done with the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">bundle</span> <span class="pre">create</span></code> command, passing the list of all lockfiles
for all configurations and products, and obtaining one single output bundle:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>bundle<span class="w"> </span>create<span class="w"> </span>app1_windows.lock<span class="w"> </span>app1_linux.lock<span class="w"> </span>app2_windows.lock<span class="w"> </span>app2_linux.lock<span class="w"> </span>--bundle-out<span class="o">=</span>lock.bundle
</pre></div>
</div>
<p>Inspecting the resulting lockfile bundle file, we can see it is a json file with the following structure:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;lock_bundle&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;app1/1.1@#584778f98ba1d0eb7c80a5ae1fe12fe2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">                </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3bcd6800847f779e0883ee91b411aad9ddd8e83c&quot;</span><span class="w"> </span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;lockfiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;app1_windows.lock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="s2">&quot;1&quot;</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;prev&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;modified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60fbb0a22359b4888f7ecad69bcdfcd6e70e2784&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;lockfiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;app1_linux.lock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="s2">&quot;1&quot;</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;prev&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;modified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;requires&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;pkgb/0.1@#cd8f22d6f264f65398d8c534046e8e20&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The bundle groups items per “recipe reference”, included the recipe revision, like <code class="docutils literal notranslate"><span class="pre">app1/1.1&#64;#584778f98ba1d0eb7c80a5ae1fe12fe2</span></code>.
For each one, it will list all different binaries, identified by their <code class="docutils literal notranslate"><span class="pre">package_id</span></code> that are involved in the different
lockfiles, listing all lockfiles for each <code class="docutils literal notranslate"><span class="pre">package_id</span></code>. In this case, as <code class="docutils literal notranslate"><span class="pre">app1</span></code> only belongs to app1 lockfiles, only
one lockfile <code class="docutils literal notranslate"><span class="pre">app1_windows.lock</span></code>, <code class="docutils literal notranslate"><span class="pre">app1_linux.lock</span></code> is in each <code class="docutils literal notranslate"><span class="pre">package_id</span></code>. Also, the package revision <code class="docutils literal notranslate"><span class="pre">prev</span></code> is listed,
in this case being <code class="docutils literal notranslate"><span class="pre">null</span></code>, because there is no locked binary in the lockfiles, but is going to be built.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The relative path between the bundle file and the lockfile files need to be maintained. In the example
<code class="docutils literal notranslate"><span class="pre">app1_linux.lock</span></code> means that the lockfile is located in the same folder as the bundle file itself. If
moving the bundle to a different machine, the lockfiles should be moved too, maintaining the same relative
layout.</p>
</div>
<p>The interesting part is in the <code class="docutils literal notranslate"><span class="pre">pkga/0.1</span></code> information in the bundle:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;pkga/0.1@#f096d7d54098b7ad7012f9435d9c33f3&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">            </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3475bd55b91ae904ac96fde0f106a136ab951a5e&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;lockfiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;app1_windows.lock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;3&quot;</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">                </span><span class="nt">&quot;app2_windows.lock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;3&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;prev&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;modified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we can see that for one <code class="docutils literal notranslate"><span class="pre">package_id</span></code> there are actually 2 different lockfiles that require it. Both <code class="docutils literal notranslate"><span class="pre">app1</span></code> and <code class="docutils literal notranslate"><span class="pre">app2</span></code>
depend in this case on <code class="docutils literal notranslate"><span class="pre">pkga/0.1</span></code>.
This is the information that can be used to avoid duplicated builds.</p>
</section>
<section id="using-a-lockfile-bundle-to-build">
<h2>Using a lockfile bundle to build<a class="headerlink" href="#using-a-lockfile-bundle-to-build" title="Link to this heading"></a></h2>
<p>The lockfile bundles also can compute a “build order” over the bundle, that will give an ordered list of lists of the
package references that need to be built. In our case we could do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>lock<span class="w"> </span>bundle<span class="w"> </span>build-order<span class="w"> </span>lock.bundle<span class="w"> </span>--json<span class="o">=</span>build_order.json
<span class="o">[</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;pkga/0.1@#f096d7d54098b7ad7012f9435d9c33f3&quot;</span><span class="o">]</span>,
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;pkgb/0.1@#cd8f22d6f264f65398d8c534046e8e20&quot;</span>,<span class="w"> </span><span class="s2">&quot;pkgb/0.2@#cd8f22d6f264f65398d8c534046e8e20&quot;</span><span class="o">]</span>,
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;app1/0.1@#584778f98ba1d0eb7c80a5ae1fe12fe2&quot;</span>,<span class="w"> </span><span class="s2">&quot;app2/0.1@#3850895c1eac8223c43c71d525348019&quot;</span><span class="o">]</span>
<span class="o">]</span>
</pre></div>
</div>
<p>The result is a list of lists. Every inner list is a “level”, it is formed by mutually independent references that
can be built in parallel, because they don’t depend on each other. But every level will have dependencies to the
previous levels, so it is necessary to build those levels in order.</p>
<p>The build order list can be iterated, building the packages in order. The necessary information is in the bundle
file itself, so we can read it and use it, something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the build order</span>
<span class="n">build_order</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;build_order.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># Read the bundle</span>
<span class="n">bundle</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;lock.bundle&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">bundle</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">[</span><span class="s2">&quot;lock_bundle&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">build_order</span><span class="p">:</span>  <span class="c1"># iterate the build_order</span>
    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">level</span><span class="p">:</span>  <span class="c1"># All refs in this level could be built in parallel</span>
        <span class="c1"># Now get the package_ids and lockfile information</span>
        <span class="n">package_ids</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="s2">&quot;package_id&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pkg_id</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">package_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">lockfiles</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;lockfiles&quot;</span><span class="p">]</span>
            <span class="n">lockfile</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lockfiles</span><span class="p">)))</span>  <span class="c1"># Get the first one, all should be valid to build same package_id</span>

            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;conan install </span><span class="si">{ref}</span><span class="s2"> --build=</span><span class="si">{ref}</span><span class="s2"> --lockfile=</span><span class="si">{lockfile}</span><span class="s2"> &quot;</span>
                      <span class="s2">&quot;--lockfile-out=</span><span class="si">{lockfile}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">lockfile</span><span class="o">=</span><span class="n">lockfile</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;conan lock bundle update lock.bundle&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This works under the hypothesis that the same binary, identified by the same <code class="docutils literal notranslate"><span class="pre">package_id</span></code> will be obtained irrespective
of which lockfile or final product is used to build it. If this doesn’t hold true, then the <code class="docutils literal notranslate"><span class="pre">package_id</span></code> policies should
be revised until this condition is met.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Recall that this is an orchestration mechanism, that can be used to distribute the actual <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> tasks
to different agents, based on the lockfile itself, we might need some logic to send that build to one or another
build server. If we didn’t want to orchestrate and everything can be built in this machine a
<code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span> <span class="pre">app1/1.1&#64;</span> <span class="pre">--lockfile={lockfile}</span> <span class="pre">--build=missing</span></code> would build all the necessary dependencies in the
graph, in the current agent.</p>
</div>
<p>Note that the builds themselves are using regular lockfiles. The bundle does not contain the necessary information to
reproduce the dependency graph that is needed to create packages.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">bundle</span> <span class="pre">update</span> <span class="pre">lock.bundle</span></code> manages to update all the connected lockfiles after a reference has been
built. When the build is fired, it is done using 1 of the lockfiles, for a given configuration. That lockfile will get the
updated package revision and status. The <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">bundle</span> <span class="pre">update</span></code> does this process in 2 steps:</p>
<ul class="simple">
<li><p>Scan all connected lockfiles for every <code class="docutils literal notranslate"><span class="pre">ref</span></code> recipe reference and <code class="docutils literal notranslate"><span class="pre">package_id</span></code>, and collect those that have been modified.</p></li>
<li><p>Propagate the modified information to all the other connected lockfiles.</p></li>
</ul>
<p>After <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">bundle</span> <span class="pre">update</span></code>, all packages sharing the same reference and <code class="docutils literal notranslate"><span class="pre">package_id</span></code> should
have the same status (marked “modified” and same package revision). The “modified” state for the
lockfile bundles can be cleaned using the command <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">lock</span> <span class="pre">bundle</span> <span class="pre">clean-modified</span></code> that will
clean that flag from both the <em>.bundle</em> file and the individual <em>.lock</em> files.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_order.html" class="btn btn-neutral float-left" title="Build order in lockfiles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ci.html" class="btn btn-neutral float-right" title="Lockfiles in Continuous Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">Last updated on Sep 29, 2025.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: 1.63
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
    <dt>Versions</dt>
    
        
            <dd><a href="/2.21/index.html">2.21</a></dd>
        
    
        
            <dd><a href="/2.20/index.html">2.20</a></dd>
        
    
        
            <dd><a href="/2.19/index.html">2.19</a></dd>
        
    
        
            <dd><a href="/2.18/index.html">2.18</a></dd>
        
    
        
            <dd><a href="/2.17/index.html">2.17</a></dd>
        
    
        
            <dd><a href="/2.16/index.html">2.16</a></dd>
        
    
        
            <dd><a href="/2.15/index.html">2.15</a></dd>
        
    
        
            <dd><a href="/2.14/index.html">2.14</a></dd>
        
    
        
            <dd><a href="/2.13/index.html">2.13</a></dd>
        
    
        
            <dd><a href="/2.12/index.html">2.12</a></dd>
        
    
        
            <dd><a href="/2.11/index.html">2.11</a></dd>
        
    
        
            <dd><a href="/2.10/index.html">2.10</a></dd>
        
    
        
            <dd><a href="/2.9/index.html">2.9</a></dd>
        
    
        
            <dd><a href="/2.8/index.html">2.8</a></dd>
        
    
        
            <dd><a href="/2.7/index.html">2.7</a></dd>
        
    
        
            <dd><a href="/2.6/index.html">2.6</a></dd>
        
    
        
            <dd><a href="/2.5/index.html">2.5</a></dd>
        
    
        
            <dd><a href="/2.4/index.html">2.4</a></dd>
        
    
        
            <dd><a href="/2.3/index.html">2.3</a></dd>
        
    
        
            <dd><a href="/2.2/index.html">2.2</a></dd>
        
    
        
            <dd><a href="/2.1/index.html">2.1</a></dd>
        
    
        
            <dd><a href="/2.0/index.html">2.0</a></dd>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/2/index.html">2</a></dd>
        
    
    <br>
        <details>
            <summary>Conan 1 releases</summary>
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <dd><a href="/1/index.html">1</a></dd>
        
    
        
            <dd><a href="/en/1.66/index.html">1.66</a></dd>
        
    
        
            <dd><a href="/en/1.65/index.html">1.65</a></dd>
        
    
        
            <dd><a href="/en/1.64/index.html">1.64</a></dd>
        
    
        
            <dd><a href="/en/1.63/index.html">1.63</a></dd>
        
    
        
            <dd><a href="/en/1.62/index.html">1.62</a></dd>
        
    
        
            <dd><a href="/en/1.61/index.html">1.61</a></dd>
        
    
        
            <dd><a href="/en/1.60/index.html">1.60</a></dd>
        
    
        
            <dd><a href="/en/1.59/index.html">1.59</a></dd>
        
    
        
            <dd><a href="/en/1.58/index.html">1.58</a></dd>
        
    
        
            <dd><a href="/en/1.57/index.html">1.57</a></dd>
        
    
        
            <dd><a href="/en/1.56/index.html">1.56</a></dd>
        
    
        
            <dd><a href="/en/1.55/index.html">1.55</a></dd>
        
    
        
            <dd><a href="/en/1.54/index.html">1.54</a></dd>
        
    
        
            <dd><a href="/en/1.53/index.html">1.53</a></dd>
        
    
        
            <dd><a href="/en/1.52/index.html">1.52</a></dd>
        
    
        
            <dd><a href="/en/1.51/index.html">1.51</a></dd>
        
    
        
            <dd><a href="/en/1.50/index.html">1.50</a></dd>
        
    
        
            <dd><a href="/en/1.49/index.html">1.49</a></dd>
        
    
        
            <dd><a href="/en/1.48/index.html">1.48</a></dd>
        
    
        
            <dd><a href="/en/1.47/index.html">1.47</a></dd>
        
    
        
            <dd><a href="/en/1.46/index.html">1.46</a></dd>
        
    
        
            <dd><a href="/en/1.45/index.html">1.45</a></dd>
        
    
        
            <dd><a href="/en/1.44/index.html">1.44</a></dd>
        
    
        
            <dd><a href="/en/1.43/index.html">1.43</a></dd>
        
    
        
            <dd><a href="/en/1.42/index.html">1.42</a></dd>
        
    
        
            <dd><a href="/en/1.41/index.html">1.41</a></dd>
        
    
        
            <dd><a href="/en/1.40/index.html">1.40</a></dd>
        
    
        
            <dd><a href="/en/1.39/index.html">1.39</a></dd>
        
    
        
            <dd><a href="/en/1.38/index.html">1.38</a></dd>
        
    
        
            <dd><a href="/en/1.37/index.html">1.37</a></dd>
        
    
        
            <dd><a href="/en/1.36/index.html">1.36</a></dd>
        
    
        
            <dd><a href="/en/1.35/index.html">1.35</a></dd>
        
    
        
            <dd><a href="/en/1.34/index.html">1.34</a></dd>
        
    
        
            <dd><a href="/en/1.33/index.html">1.33</a></dd>
        
    
        
            <dd><a href="/en/1.32/index.html">1.32</a></dd>
        
    
        
            <dd><a href="/en/1.31/index.html">1.31</a></dd>
        
    
        
            <dd><a href="/en/1.30/index.html">1.30</a></dd>
        
    
        
            <dd><a href="/en/1.29/index.html">1.29</a></dd>
        
    
        
            <dd><a href="/en/1.28/index.html">1.28</a></dd>
        
    
        
            <dd><a href="/en/1.27/index.html">1.27</a></dd>
        
    
        
            <dd><a href="/en/1.26/index.html">1.26</a></dd>
        
    
        
            <dd><a href="/en/1.25/index.html">1.25</a></dd>
        
    
        
            <dd><a href="/en/1.24/index.html">1.24</a></dd>
        
    
        
            <dd><a href="/en/1.23/index.html">1.23</a></dd>
        
    
        
            <dd><a href="/en/1.22/index.html">1.22</a></dd>
        
    
        
            <dd><a href="/en/1.21/index.html">1.21</a></dd>
        
    
        
            <dd><a href="/en/1.20/index.html">1.20</a></dd>
        
    
        
            <dd><a href="/en/1.19/index.html">1.19</a></dd>
        
    
        
            <dd><a href="/en/1.18/index.html">1.18</a></dd>
        
    
        
            <dd><a href="/en/1.17/index.html">1.17</a></dd>
        
    
        
            <dd><a href="/en/1.16/index.html">1.16</a></dd>
        
    
        
            <dd><a href="/en/1.15/index.html">1.15</a></dd>
        
    
        
            <dd><a href="/en/1.14/index.html">1.14</a></dd>
        
    
        
            <dd><a href="/en/1.13/index.html">1.13</a></dd>
        
    
        
            <dd><a href="/en/1.12/index.html">1.12</a></dd>
        
    
        
            <dd><a href="/en/1.11/index.html">1.11</a></dd>
        
    
        
            <dd><a href="/en/1.10/index.html">1.10</a></dd>
        
    
        
            <dd><a href="/en/1.9/index.html">1.9</a></dd>
        
    
        
            <dd><a href="/en/1.8/index.html">1.8</a></dd>
        
    
        
            <dd><a href="/en/1.7/index.html">1.7</a></dd>
        
    
        
            <dd><a href="/en/1.6/index.html">1.6</a></dd>
        
    
        
            <dd><a href="/en/1.5/index.html">1.5</a></dd>
        
    
        
            <dd><a href="/en/1.4/index.html">1.4</a></dd>
        
    
        
            <dd><a href="/en/1.3/index.html">1.3</a></dd>
        
    
        
    
        </details>
    </dl>
    <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/en/1.63/conan.pdf">PDF</a></dd>
        
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

<noscript><iframe src="https://gtm.jfrog.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>