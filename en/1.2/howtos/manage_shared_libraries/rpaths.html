



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Manage RPATHs &mdash; conan 1.2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="conan 1.2.0 documentation" href="../../index.html"/>
        <link rel="up" title="How to manage shared libraries" href="../manage_shared_libraries.html"/>
        <link rel="next" title="How to reuse cmake install for package() method" href="../cmake_install.html"/>
        <link rel="prev" title="Manage Shared Libraries with Environment Variables" href="env_vars.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53TFLK7');</script>
<!-- End Google Tag Manager -->
 

</script>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://conan.io">
          

          
            
            <img src="../../_static/conan_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../conan1.0.html">Upgrading to conan 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../creating_packages.html">Creating packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uploading_packages.html">Uploading packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mastering.html">Mastering conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../howtos.html">Howtos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../header_only.html">How to package header-only libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmake_launch.html">How to launch conan install from cmake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual_studio_packages.html">How to create and reuse packages based on Visual Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makefiles.html">Creating and reusing packages based on Makefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manage_gcc_abi.html">How to manage the GCC &gt;= 5 ABI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vs2017_cmake.html">Using Visual Studio 2017 - CMake integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manage_cpp_standard.html">How to manage C++ standard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../run_conan_in_docker.html">How to use docker to create and cross build C and C++ conan packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_code_reuse.html">How to reuse Python code in recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_generators.html">How to create and share a custom generator with generator packages</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../manage_shared_libraries.html">How to manage shared libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="env_vars.html">Manage Shared Libraries with Environment Variables</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Manage RPATHs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-conan-approach">Default Conan approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#different-approaches">Different approaches</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cmake_install.html">How to reuse cmake install for package() method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collaborate_packages.html">How to collaborate on other users’ packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../link_apple_framework.html">How to link with Apple Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collect_licenses.html">How to collect licenses of dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../capture_version.html">How to capture package version from text or build files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_languages_package_manager.html">How to use Conan as other language package manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_tls_certificates.html">How to manage SSL (TLS) certificates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p>Sign up for release updates:</p>
              <script src="http://app-lon04.marketo.com/js/forms2/js/forms2.min.js"></script>
              <form id="mktoForm_1479"></form>
              <script>MktoForms2.loadForm("http://app-lon04.marketo.com", "256-FNZ-187", 1479);</script>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../howtos.html">Howtos</a> &raquo;</li>
        
          <li><a href="../manage_shared_libraries.html">How to manage shared libraries</a> &raquo;</li>
        
      <li>Manage RPATHs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/howtos/manage_shared_libraries/rpaths.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="manage-rpaths">
<h1>Manage RPATHs<a class="headerlink" href="#manage-rpaths" title="Permalink to this headline">¶</a></h1>
<p>The <strong>rpath</strong> is encoded inside dynamic libraries and executables and helps the linker to find its
required shared libraries.</p>
<p>If we have an executable, <strong>my_exe</strong>, that requires a shared library, <strong>shared_lib_1</strong>,
and <strong>shared_lib_1</strong>, in turn, requires another <strong>shared_lib_2</strong>.</p>
<p>So the <strong>rpaths</strong> values are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File</th>
<th class="head">rpath</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>my_exe</td>
<td>/path/to/shared_lib_1</td>
</tr>
<tr class="row-odd"><td>shared_lib_1</td>
<td>/path/to/shared_lib_2</td>
</tr>
<tr class="row-even"><td>shared_lib_2</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>In <strong>linux</strong> if the linker doesn’t find the library in <strong>rpath</strong>, it will continue the search in
<strong>system defaults paths</strong> (LD_LIBRARY_PATH… etc)
In OSX, if the linker detects an invalid <strong>rpath</strong> (the file does not exist there), it will fail.</p>
<div class="section" id="default-conan-approach">
<h2>Default Conan approach<a class="headerlink" href="#default-conan-approach" title="Permalink to this headline">¶</a></h2>
<p>The consumer project of dependencies with shared libraries needs to import them to the executable
directory to be able to run it:</p>
<p><strong>conanfile.txt</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[requires]
Poco/1.7.8p3@pocoproject/stable

[imports]
bin, *.dll -&gt; ./bin # Copies all dll files from packages bin folder to my &quot;bin&quot; folder
lib, *.dylib* -&gt; ./bin # Copies all dylib files from packages lib folder to my &quot;bin&quot; folder
</pre></div>
</div>
<p>On <strong>Windows</strong> this approach works well, importing the shared library to the directory containing
your executable is a very common procedure.</p>
<p>On <strong>Linux</strong> there is an additional problem, the dynamic linker doesn’t look by default in the
executable directory, and you will need to adjust the <cite>LD_LIBRARY_PATH</cite> environment variable like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> <span class="o">&amp;&amp;</span> ./mybin
</pre></div>
</div>
<p>On <strong>OSX</strong> if absolute rpaths are hardcoded in an executable or
shared library and they don’t exist the executable will fail to run. This is the most common problem when
we reuse packages in a different environment from where the artifacts have been generated.</p>
<p>So, for <strong>OSX</strong>, conan, by default when you build your library with <strong>CMake</strong>, the rpaths will be
generated without any path:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File</th>
<th class="head">rpath</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>my_exe</td>
<td>shared_lib_1.dylib</td>
</tr>
<tr class="row-odd"><td>shared_lib_1.dylib</td>
<td>shared_lib_2.dylib</td>
</tr>
<tr class="row-even"><td>shared_lib_2.dylib</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">conan_basic_setup()</span></code> macro will set the <code class="docutils literal notranslate"><span class="pre">set(CMAKE_SKIP_RPATH</span> <span class="pre">1)</span></code> in OSX.</p>
<p>You can skip this default behavior by passing the <code class="docutils literal notranslate"><span class="pre">KEEP_RPATHS</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">conan_basic_setup</span></code> macro:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="o">}</span><span class="s">/conanbuildinfo.cmake</span><span class="p">)</span>
<span class="nb">conan_basic_setup</span><span class="p">(</span><span class="s">KEEP_RPATHS</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">timer</span> <span class="s">timer.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">timer</span> <span class="o">${</span><span class="nv">CONAN_LIBS</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">autotools</span></code> conan won’t auto-adjust the rpaths behavior, if you want to follow this
default behavior probably you will need to replace the <code class="docutils literal notranslate"><span class="pre">install_name</span></code> in the <strong>configure</strong> or <strong>MakeFile</strong>
generated files in your recipe to not use $rpath:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">replace_in_file</span><span class="p">(</span><span class="s2">&quot;./configure&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;-install_name \$rpath/&quot;</span><span class="p">,</span> <span class="s2">&quot;-install_name &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="different-approaches">
<h2>Different approaches<a class="headerlink" href="#different-approaches" title="Permalink to this headline">¶</a></h2>
<p>You can adjust the <strong>rpaths</strong> in the way that adapts better to your needs.</p>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">CMake</span></code> take a look to the <a class="reference external" href="https://cmake.org/Wiki/CMake_RPATH_handling">CMake RPATH handling</a> guide.</p>
<p>Remember to pass the <code class="docutils literal notranslate"><span class="pre">KEEP_RPATHS</span></code> variable to the <code class="docutils literal notranslate"><span class="pre">conan_basic_setup</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="o">}</span><span class="s">/conanbuildinfo.cmake</span><span class="p">)</span>
<span class="nb">conan_basic_setup</span><span class="p">(</span><span class="s">KEEP_RPATHS</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, you could, for example, use the <code class="docutils literal notranslate"><span class="pre">&#64;executable_path</span></code> in OSX and <code class="docutils literal notranslate"><span class="pre">$ORIGIN</span></code> in Linux  to adjust
a relative path from the executable:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span> <span class="p">(</span><span class="s">APPLE</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_INSTALL_RPATH</span> <span class="s2">&quot;@executable_path/../lib&quot;</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_INSTALL_RPATH</span> <span class="s2">&quot;$ORIGIN/../lib&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>You can use this imports statements in the consumer project:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[requires]
Poco/1.7.8p3@pocoproject/stable

[imports]
bin, *.dll -&gt; ./bin # Copies all dll files from packages bin folder to my &quot;bin&quot; folder
lib, *.dylib* -&gt; ./lib # Copies all dylib files from packages lib folder to my &quot;lib&quot; folder
lib, *.so* -&gt; ./lib # Copies all so files from packages lib folder to my &quot;lib&quot; folder
</pre></div>
</div>
<p>And your finally application can follow this layout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bin
 |_____ my_executable
 |_____ mylib.dll
 |
lib
 |_____ libmylib.so
 |_____ libmylib.dylib
</pre></div>
</div>
<p>You could move the entire application folder to any location and the shared libraries will be located
correctly.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cmake_install.html" class="btn btn-neutral float-right" title="How to reuse cmake install for package() method" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="env_vars.html" class="btn btn-neutral" title="Manage Shared Libraries with Environment Variables" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, JFrog.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53TFLK7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>