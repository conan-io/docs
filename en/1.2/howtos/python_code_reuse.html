



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to reuse Python code in recipes &mdash; conan 1.2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="conan 1.2.0 documentation" href="../index.html"/>
        <link rel="up" title="Howtos" href="../howtos.html"/>
        <link rel="next" title="How to create and share a custom generator with generator packages" href="custom_generators.html"/>
        <link rel="prev" title="How to use docker to create and cross build C and C++ conan packages" href="run_conan_in_docker.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53TFLK7');</script>
<!-- End Google Tag Manager -->
 

</script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://conan.io">
          

          
            
            <img src="../_static/conan_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conan1.0.html">Upgrading to conan 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_packages.html">Creating packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uploading_packages.html">Uploading packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mastering.html">Mastering conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../howtos.html">Howtos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="header_only.html">How to package header-only libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmake_launch.html">How to launch conan install from cmake</a></li>
<li class="toctree-l2"><a class="reference internal" href="visual_studio_packages.html">How to create and reuse packages based on Visual Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="makefiles.html">Creating and reusing packages based on Makefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage_gcc_abi.html">How to manage the GCC &gt;= 5 ABI</a></li>
<li class="toctree-l2"><a class="reference internal" href="vs2017_cmake.html">Using Visual Studio 2017 - CMake integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage_cpp_standard.html">How to manage C++ standard</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_conan_in_docker.html">How to use docker to create and cross build C and C++ conan packages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to reuse Python code in recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-basic-python-package">A basic Python package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reusing-python-code-in-your-recipes">Reusing python code in your recipes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requiring-a-python-conan-package">Requiring a python conan package</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sharing-a-python-module">Sharing a python module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="custom_generators.html">How to create and share a custom generator with generator packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage_shared_libraries.html">How to manage shared libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmake_install.html">How to reuse cmake install for package() method</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborate_packages.html">How to collaborate on other users’ packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_apple_framework.html">How to link with Apple Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="collect_licenses.html">How to collect licenses of dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture_version.html">How to capture package version from text or build files</a></li>
<li class="toctree-l2"><a class="reference internal" href="other_languages_package_manager.html">How to use Conan as other language package manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_tls_certificates.html">How to manage SSL (TLS) certificates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p>Sign up for release updates:</p>
              <script src="http://app-lon04.marketo.com/js/forms2/js/forms2.min.js"></script>
              <form id="mktoForm_1479"></form>
              <script>MktoForms2.loadForm("http://app-lon04.marketo.com", "256-FNZ-187", 1479);</script>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../howtos.html">Howtos</a> &raquo;</li>
        
      <li>How to reuse Python code in recipes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/howtos/python_code_reuse.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-reuse-python-code-in-recipes">
<span id="python-reuse"></span><h1>How to reuse Python code in recipes<a class="headerlink" href="#how-to-reuse-python-code-in-recipes" title="Permalink to this headline">¶</a></h1>
<p>First, if you feel that you are repeating a lot of Python code, and that repeated code could be
useful for other Conan users, please propose it in a github issue.</p>
<p>There are several ways to handle Python code reuse in package recipes:</p>
<ul class="simple">
<li>To put common code in files, as explained <a class="reference internal" href="#split-conanfile"><span class="std std-ref">below</span></a>. This code
has to be exported into the recipe itself.</li>
<li>To create a Conan package with the common python code, and then <code class="docutils literal notranslate"><span class="pre">require</span></code> it from the recipe.</li>
</ul>
<p>This howto explains the latter.</p>
<div class="section" id="a-basic-python-package">
<h2>A basic Python package<a class="headerlink" href="#a-basic-python-package" title="Permalink to this headline">¶</a></h2>
<p>Let’s begin with a simple python package, a “hello world” functionality that we want to package and reuse:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Hello World from Python!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To create a package, all we need to do is create the following layout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-| hello.py
 | __init__.py
 | conanfile.py
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> is blank.
It is not necessary to compile code, so the package recipe <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> is quite simple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span> <span class="nc">HelloPythonConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;HelloPy&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
    <span class="n">exports</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
    <span class="n">build_policy</span> <span class="o">=</span> <span class="s2">&quot;missing&quot;</span>

    <span class="k">def</span> <span class="nf">package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s1">&#39;*.py&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span><span class="o">.</span><span class="n">PYTHONPATH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_folder</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">exports</span></code> will copy both the <code class="docutils literal notranslate"><span class="pre">hello.py</span></code> and the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> into the recipe. The <code class="docutils literal notranslate"><span class="pre">package()</span></code> method is also obvious: to
construct the package just copy the python sources.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">package_info()</span></code> adds the current package folder to the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> conan environment variable. It will not affect the real
environment variable unless the end user wants it.</p>
<p>It can be seen that this recipe would be practically the same for most python packages, so it could be factored in a <code class="docutils literal notranslate"><span class="pre">PythonConanFile</span></code>
base class to further simplify it (open a feature request, or better a pull request :) )</p>
<p>With this recipe, all we have to do is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan <span class="nb">export</span> . memsharded/testing
</pre></div>
</div>
<p>Of course if you want to share the package with your team, you can <strong class="command">conan upload</strong> it to a remote server. But to create and test the
package, we can do everything locally.</p>
<p>Now the package is ready for consumption. In another folder, we can create a <em>conanfile.txt</em> (or a <em>conanfile.py</em> if we prefer):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[requires]
HelloPy/0.1@memsharded/testing
</pre></div>
</div>
<p>And install it with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . -g virtualenv
</pre></div>
</div>
<p>Creating the above <code class="docutils literal notranslate"><span class="pre">conanfile.txt</span></code> might be unnecessary for this simple example, as you can directly run
<strong class="command">conan install HelloPy/0.1&#64;memsharded/testing -g virtualenv</strong>, however, using the file is the canonical way.</p>
<p>The specified <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> generator will create an <code class="docutils literal notranslate"><span class="pre">activate</span></code> script (in Windows <em>activate.bat</em>), that basically contains the
environment, in this case, the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>. Once we activate it, we are able to find the package in the path and use it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ activate
$ python
Python <span class="m">2</span>.7.12 <span class="o">(</span>v2.7.12:d33e0cf91556, Jun <span class="m">27</span> <span class="m">2016</span>, <span class="m">15</span>:19:22<span class="o">)</span> <span class="o">[</span>MSC v.1500 <span class="m">32</span> bit <span class="o">(</span>Intel<span class="o">)]</span> on win32
...
&gt;&gt;&gt; import hello
&gt;&gt;&gt; hello.hello<span class="o">()</span>
Hello World from Python!
&gt;&gt;&gt;
</pre></div>
</div>
<p>The above shows an interactive session, but you can import also the functionality in a regular python script.</p>
</div>
<div class="section" id="reusing-python-code-in-your-recipes">
<h2>Reusing python code in your recipes<a class="headerlink" href="#reusing-python-code-in-your-recipes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="requiring-a-python-conan-package">
<h3>Requiring a python conan package<a class="headerlink" href="#requiring-a-python-conan-package" title="Permalink to this headline">¶</a></h3>
<p>As the conan recipes are python code itself, it is easy to reuse python packages in them. A basic recipe using the created package would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span> <span class="nc">HelloPythonReuseConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="s2">&quot;HelloPy/0.1@memsharded/testing&quot;</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">hello</span> <span class="kn">import</span> <span class="n">hello</span>
        <span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">requires</span></code> section is just referencing the previously created package. The functionality of that package can be used in several
methods of the recipe: <code class="docutils literal notranslate"><span class="pre">source()</span></code>, <code class="docutils literal notranslate"><span class="pre">build()</span></code>, <code class="docutils literal notranslate"><span class="pre">package()</span></code> and <code class="docutils literal notranslate"><span class="pre">package_info()</span></code>, i.e. all of the methods used for creating the
package itself. Note that in other places it is not possible, as it would require the dependencies of the recipe to be already retrieved,
and such dependencies cannot be retrieved until the basic evaluation of the recipe has been executed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install .
...
$ conan build .
Hello World from Python!
</pre></div>
</div>
</div>
<div class="section" id="sharing-a-python-module">
<h3>Sharing a python module<a class="headerlink" href="#sharing-a-python-module" title="Permalink to this headline">¶</a></h3>
<p>Another approach is sharing a python module and exporting within the recipe.</p>
<p id="split-conanfile">Lets write for example a <code class="docutils literal notranslate"><span class="pre">msgs.py</span></code> file and put it besides the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_msg</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
    <span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And then the main <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">msgs</span> <span class="kn">import</span> <span class="n">build_msg</span>

<span class="k">class</span> <span class="nc">ConanFileToolsTest</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.9&quot;</span>
    <span class="n">exports</span> <span class="o">=</span> <span class="s2">&quot;msgs.py&quot;</span>  <span class="c1"># Important to remember!</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">build_msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>It is important to note that such <code class="docutils literal notranslate"><span class="pre">msgs.py</span></code> file <strong>must be exported</strong> too when exporting the package, because package recipes must be
self-contained.</p>
<p>The code reuse can also be done in the form of a base class, something like a file <code class="docutils literal notranslate"><span class="pre">base_conan.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span> <span class="nc">ConanBase</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="c1"># common code here</span>
</pre></div>
</div>
<p>And then:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">base_conan</span> <span class="kn">import</span> <span class="n">ConanBase</span>

<span class="k">class</span> <span class="nc">ConanFileToolsTest</span><span class="p">(</span><span class="n">ConanBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.9&quot;</span>
    <span class="n">exports</span> <span class="o">=</span> <span class="s2">&quot;base_conan.py&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="custom_generators.html" class="btn btn-neutral float-right" title="How to create and share a custom generator with generator packages" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="run_conan_in_docker.html" class="btn btn-neutral" title="How to use docker to create and cross build C and C++ conan packages" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, JFrog.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53TFLK7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>