



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running and deploying packages &mdash; conan 1.22.3 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="conan 1.22.3 documentation" href="../index.html"/>
        <link rel="up" title="Package apps and devtools" href="../devtools.html"/>
        <link rel="next" title="Creating conan packages to install dev tools" href="create_installer_packages.html"/>
        <link rel="prev" title="Package apps and devtools" href="../devtools.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://conan.io">
          

          
            
            <img src="../_static/conan-logo.png" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uploading_packages.html">Uploading Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../devtools.html">Package apps and devtools</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Running and deploying packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-virtual-environments">Using virtual environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployable-packages">Deployable packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-deploy-generator">Using the <cite>deploy</cite> generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-json-generator">Using the <cite>json</cite> generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-from-packages">Running from packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-packages-and-re-packaging">Runtime packages and re-packaging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deployment-challenges">Deployment challenges</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="create_installer_packages.html">Creating conan packages to install dev tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_requires.html">Build requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mastering.html">Mastering Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">Howtos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p>Sign up for release updates:</p>
              <script src="https://app-lon04.marketo.com/js/forms2/js/forms2.min.js"></script>
              <form id="mktoForm_1479"></form>
              <script>MktoForms2.loadForm("https://app-lon04.marketo.com", "256-FNZ-187", 1479);</script>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../devtools.html">Package apps and devtools</a> &raquo;</li>
        
      <li>Running and deploying packages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/master/devtools/running_packages.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-and-deploying-packages">
<span id="running-packages"></span><h1>Running and deploying packages<a class="headerlink" href="#running-and-deploying-packages" title="Permalink to this headline">¶</a></h1>
<p>Executables and applications including shared libraries can also be distributed, deployed and run with Conan. This might have
some advantages compared to deploying with other systems:</p>
<ul class="simple">
<li>A unified development and distribution tool, for all systems and platforms.</li>
<li>Manage any number of different deployment configurations in the same way you manage them for development.</li>
<li>Use a Conan server remote to store all your applications and runtimes for all Operating Systems, platforms and targets.</li>
</ul>
<p>There are different approaches:</p>
<div class="section" id="using-virtual-environments">
<h2>Using virtual environments<a class="headerlink" href="#using-virtual-environments" title="Permalink to this headline">¶</a></h2>
<p>We can create a package that contains an executable, for example from the default package template created by <strong class="command">conan new</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan new Hello/0.1
</pre></div>
</div>
<p>The source code used contains an executable called <code class="docutils literal notranslate"><span class="pre">greet</span></code>, but it is not packaged by default. Let’s modify the recipe
<code class="docutils literal notranslate"><span class="pre">package()</span></code> method to also package the executable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;*greet*&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">keep_path</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we create the package as usual, but if we try to run the executable it won’t be found:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan create . user/testing
...
Hello/0.1@user/testing package<span class="o">()</span>: Copied <span class="m">1</span> <span class="s1">&#39;.h&#39;</span> files: hello.h
Hello/0.1@user/testing package<span class="o">()</span>: Copied <span class="m">1</span> <span class="s1">&#39;.exe&#39;</span> files: greet.exe
Hello/0.1@user/testing package<span class="o">()</span>: Copied <span class="m">1</span> <span class="s1">&#39;.lib&#39;</span> files: hello.lib

$ greet
&gt; ... not found...
</pre></div>
</div>
<p>By default, Conan does not modify the environment, it will just create the package in the local cache, and that is not
in the system PATH, so the <code class="docutils literal notranslate"><span class="pre">greet</span></code> executable is not found.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">virtualrunenv</span></code> generator generates files that add the package’s default binary locations to the necessary paths:</p>
<ul class="simple">
<li>It adds the dependencies <code class="docutils literal notranslate"><span class="pre">lib</span></code> subfolder to the <code class="docutils literal notranslate"><span class="pre">DYLD_LIBRARY_PATH</span></code> environment variable (for OSX shared libraries)</li>
<li>It adds the dependencies <code class="docutils literal notranslate"><span class="pre">lib</span></code> subfolder to the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable (for Linux shared libraries)</li>
<li>It adds the dependencies <code class="docutils literal notranslate"><span class="pre">bin</span></code> subfolder to the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable (for executables)</li>
</ul>
<p>So if we install the package, specifying such <code class="docutils literal notranslate"><span class="pre">virtualrunenv</span></code> like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install Hello/0.1@user/testing -g virtualrunenv
</pre></div>
</div>
<p>This will generate a few files that can be called to activate and deactivate the required environment variables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ activate_run.sh <span class="c1"># $ source activate_run.sh in Unix/Linux</span>
$ greet
&gt; Hello World!
$ deactivate_run.sh <span class="c1"># $ source deactivate_run.sh in Unix/Linux</span>
</pre></div>
</div>
</div>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>It is possible to define a custom conanfile (either .txt or .py), with an <code class="docutils literal notranslate"><span class="pre">imports</span></code> section, that can retrieve from local
cache the desired files. This approach requires a user conanfile.
For more details see example below <a class="reference internal" href="#repackage"><span class="std std-ref">runtime packages</span></a></p>
</div>
<div class="section" id="deployable-packages">
<h2>Deployable packages<a class="headerlink" href="#deployable-packages" title="Permalink to this headline">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">deploy()</span></code> method, a package can specify which files and artifacts to copy to user space or to other
locations in the system. Let’s modify the example recipe adding the <code class="docutils literal notranslate"><span class="pre">deploy()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And run <strong class="command">conan create</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan create . user/testing
</pre></div>
</div>
<p>With that method in our package recipe, it will copy the executable when installed directly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install Hello/0.1@user/testing
...
&gt; Hello/0.1@user/testing deploy<span class="o">()</span>: Copied <span class="m">1</span> <span class="s1">&#39;.exe&#39;</span> files: greet.exe
$ bin<span class="se">\g</span>reet.exe
&gt; Hello World!
</pre></div>
</div>
<p>The deploy will create a <em>deploy_manifest.txt</em> file with the files that have been deployed.</p>
<p>Sometimes it is useful to adjust the package ID of the deployable package in order to deploy it regardless of the compiler it was compiled
with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">package_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compiler</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Read more about the <a class="reference internal" href="../reference/conanfile/methods.html#method-deploy"><span class="std std-ref">deploy()</span></a> method.</p>
</div>
</div>
<div class="section" id="using-the-deploy-generator">
<span id="deployable-deploy-generator"></span><h2>Using the <cite>deploy</cite> generator<a class="headerlink" href="#using-the-deploy-generator" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/generators/deploy.html#deploy-generator"><span class="std std-ref">deploy generator</span></a> is used to have all the dependencies of an application copied into a single place. Then all the files can be repackaged into the distribution format of choice.
For instance, if the application depends on boost, we may not know that it also requires many other 3rt-party libraries,
such as
<a class="reference external" href="https://zlib.net/">zlib</a>,
<a class="reference external" href="https://sourceware.org/bzip2/">bzip2</a>,
<a class="reference external" href="https://tukaani.org/xz/">lzma</a>,
<a class="reference external" href="https://facebook.github.io/zstd/">zstd</a>,
<a class="reference external" href="https://www.gnu.org/software/libiconv/">iconv</a>, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . -g deploy
</pre></div>
</div>
<p>This helps to collect all the dependencies into a single place, moving them out of the Conan cache.</p>
</div>
<div class="section" id="using-the-json-generator">
<span id="deployable-json-generator"></span><h2>Using the <cite>json</cite> generator<a class="headerlink" href="#using-the-json-generator" title="Permalink to this headline">¶</a></h2>
<p>A more advanced approach is to use the <a class="reference internal" href="../reference/generators/json.html#json-generator"><span class="std std-ref">json generator</span></a>:
This generator works in a similar fashion as the <cite>deploy</cite> one, although it doesn’t copy the files to a directory. Instead, it generates a JSON file with all the information about the dependencies including the location of the files in the Conan cache.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . -g json
</pre></div>
</div>
<p>The <em>conanbuildinfo.json</em> file produced is fully machine-readable and could be used by scripts to prepare the files and recreate the appropriate format for distribution. The following code shows how to read the library and binary directories from the <em>conanbuildinfo.json</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;conanbuildinfo.json&quot;</span><span class="p">))</span>

<span class="n">dep_lib_dirs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dep_bin_dirs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]:</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="s2">&quot;rootpath&quot;</span><span class="p">]</span>
    <span class="n">lib_paths</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="s2">&quot;lib_paths&quot;</span><span class="p">]</span>
    <span class="n">bin_paths</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="s2">&quot;bin_paths&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">lib_path</span> <span class="ow">in</span> <span class="n">lib_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">lib_path</span><span class="p">):</span>
            <span class="n">lib_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
            <span class="n">dep_lib_dirs</span><span class="p">[</span><span class="n">lib_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib_dir</span>
    <span class="k">for</span> <span class="n">bin_path</span> <span class="ow">in</span> <span class="n">bin_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">bin_path</span><span class="p">):</span>
            <span class="n">bin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">bin_path</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
            <span class="n">dep_bin_dirs</span><span class="p">[</span><span class="n">bin_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_dir</span>
</pre></div>
</div>
<p>While with the <cite>deploy</cite> generator all the files were copied into a folder, the advantage with the <cite>json</cite> one is that you have fine-grained control over the files and those can be directly copied to the desired layout.
In that sense, the script above could be easily modified to apply some sort of filtering (e.g. to copy only shared libraries,
and omit any static libraries or auxiliary files such as pkg-config .pc files).</p>
<p>Additionally, you could also write a simple startup script for your application with the extracted information like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">executable</span> <span class="o">=</span> <span class="s2">&quot;MyApp&quot;</span>  <span class="c1"># just an example</span>
<span class="n">varname</span> <span class="o">=</span> <span class="s2">&quot;$APPDIR&quot;</span>

<span class="k">def</span> <span class="nf">_format_dirs</span><span class="p">(</span><span class="n">dirs</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">])</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">_format_dirs</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dep_bin_dirs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ld_library_path</span> <span class="o">=</span> <span class="n">_format_dirs</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dep_lib_dirs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">exe</span> <span class="o">=</span> <span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">executable</span>

<span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;#!/usr/bin/env bash</span>
<span class="s2">set -ex</span>
<span class="s2">export PATH=$PATH:</span><span class="si">{path}</span><span class="s2"></span>
<span class="s2">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:</span><span class="si">{ld_library_path}</span><span class="s2"></span>
<span class="s2">pushd $(dirname </span><span class="si">{exe}</span><span class="s2">)</span>
<span class="s2">$(basename </span><span class="si">{exe}</span><span class="s2">)</span>
<span class="s2">popd</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
       <span class="n">ld_library_path</span><span class="o">=</span><span class="n">ld_library_path</span><span class="p">,</span>
       <span class="n">exe</span><span class="o">=</span><span class="n">exe</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The full example might be found on <a class="reference external" href="https://github.com/conan-io/examples/tree/master/features">GitHub</a>.</p>
</div>
</div>
<div class="section" id="running-from-packages">
<h2>Running from packages<a class="headerlink" href="#running-from-packages" title="Permalink to this headline">¶</a></h2>
<p>If a dependency has an executable that we want to run in the conanfile, it can be done directly in code
using the <code class="docutils literal notranslate"><span class="pre">run_environment=True</span></code> argument. It internally uses a <code class="docutils literal notranslate"><span class="pre">RunEnvironment()</span></code> helper.
For example, if we want to execute the <strong class="command">greet</strong> app while building the <code class="docutils literal notranslate"><span class="pre">Consumer</span></code> package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">RunEnvironment</span>

<span class="k">class</span> <span class="nc">ConsumerConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Consumer&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="s2">&quot;Hello/0.1@user/testing&quot;</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;greet&quot;</span><span class="p">,</span> <span class="n">run_environment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now run <strong class="command">conan install</strong> and <strong class="command">conan build</strong> for this consumer recipe:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . <span class="o">&amp;&amp;</span> conan build .
...
Project: Running build<span class="o">()</span>
Hello World!
</pre></div>
</div>
<p>Instead of using the environment, it is also possible to explicitly access the path of the dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deps_cpp_info</span><span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rootpath</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/greet&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this might not be enough if shared libraries exist. Using the <code class="docutils literal notranslate"><span class="pre">run_environment=True</span></code> helper above
is a more complete solution.</p>
<p>Finally, there is another approach: the package containing the executable can add its <em>bin</em> folder directly to the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.
In this case the <strong>Hello</strong> package conanfile would contain:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span><span class="o">.</span><span class="n">PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_folder</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We may also define <code class="docutils literal notranslate"><span class="pre">DYLD_LIBRARY_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> if they are required for the executable.</p>
<p>The consumer package is simple, as the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable contains the <code class="docutils literal notranslate"><span class="pre">greet</span></code> executable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;greet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime-packages-and-re-packaging">
<span id="repackage"></span><h2>Runtime packages and re-packaging<a class="headerlink" href="#runtime-packages-and-re-packaging" title="Permalink to this headline">¶</a></h2>
<p>It is possible to create packages that contain only runtime binaries, getting rid of all build-time dependencies.
If we want to create a package from the above “Hello” one, but only containing the executable (remember that the above
package also contains a library, and the headers), we could do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span> <span class="nc">HellorunConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;HelloRun&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
    <span class="n">build_requires</span> <span class="o">=</span> <span class="s2">&quot;Hello/0.1@user/testing&quot;</span>
    <span class="n">keep_imports</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">imports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;greet*&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This recipe has the following characteristics:</p>
<ul class="simple">
<li>It includes the <code class="docutils literal notranslate"><span class="pre">Hello/0.1&#64;user/testing</span></code> package as <code class="docutils literal notranslate"><span class="pre">build_requires</span></code>.
That means that it will be used to build this <cite>HelloRun</cite> package, but once the <cite>HelloRun</cite> package is built,
it will not be necessary to retrieve it.</li>
<li>It is using <code class="docutils literal notranslate"><span class="pre">imports()</span></code> to copy from the dependencies, in this case, the executable</li>
<li>It is using the <code class="docutils literal notranslate"><span class="pre">keep_imports</span></code> attribute to define that imported artifacts during the <code class="docutils literal notranslate"><span class="pre">build()</span></code> step (which
is not define, then using the default empty one), are kept and not removed after build</li>
<li>The <code class="docutils literal notranslate"><span class="pre">package()</span></code> method packages the imported artifacts that will be created in the build folder.</li>
</ul>
<p>To create and upload this package to a remote:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan create . user/testing
$ conan upload HelloRun* --all -r<span class="o">=</span>my-remote
</pre></div>
</div>
<p>Installing and running this package can be done using any of the methods presented above. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install HelloRun/0.1@user/testing -g virtualrunenv
<span class="c1"># You can specify the remote with -r=my-remote</span>
<span class="c1"># It will not install Hello/0.1@...</span>
$ activate_run.sh <span class="c1"># $ source activate_run.sh in Unix/Linux</span>
$ greet
&gt; Hello World!
$ deactivate_run.sh <span class="c1"># $ source deactivate_run.sh in Unix/Linux</span>
</pre></div>
</div>
<div class="section" id="deployment-challenges">
<span id="id1"></span><h3>Deployment challenges<a class="headerlink" href="#deployment-challenges" title="Permalink to this headline">¶</a></h3>
<p>When deploying a C/C++ application there are some specific challenges that have to be solved when distributing your application. Here you
will find the most usual ones and some recommendations to overcome them.</p>
<div class="section" id="the-c-standard-library">
<h4>The C standard library<a class="headerlink" href="#the-c-standard-library" title="Permalink to this headline">¶</a></h4>
<p>A common challenge for all the applications no matter if they are written in pure C or in C++ is the dependency on C standard library. The
most wide-spread variant of this library is GNU C library or just <a class="reference external" href="https://www.gnu.org/software/libc/">glibc</a>.</p>
<p>Glibc is not a just C standard library, as it provides:</p>
<ul class="simple">
<li>C functions (like <code class="docutils literal notranslate"><span class="pre">malloc()</span></code>, <code class="docutils literal notranslate"><span class="pre">sin()</span></code>, etc.) for various language standards, including C99.</li>
<li>POSIX functions (like posix threads in the <code class="docutils literal notranslate"><span class="pre">pthread</span></code> library).</li>
<li>BSD functions (like BSD sockets).</li>
<li>Wrappers for OS-specific APIs (like Linux system calls)</li>
</ul>
<p>Even if your application doesn’t use directly any of these functions, they are often used by other libraries,
so, in practice, it’s almost always in actual use.</p>
<p>There are other implementations of the C standard library that present the same challenge, such as
<a class="reference external" href="https://sourceware.org/newlib/">newlib</a> or <a class="reference external" href="https://www.musl-libc.org/">musl</a>, used for embedded development.</p>
<p>To illustrate the problem, a simple hello-world application compiled in a modern Ubuntu distribution will give the following error when it
is run in a Centos 6 one:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> /hello
<span class="go">/hello: /lib64/libc.so.6: version `GLIBC_2.14&#39; not found (required by /hello)</span>
</pre></div>
</div>
<p>This is because the versions of the <code class="docutils literal notranslate"><span class="pre">glibc</span></code> are different between those Linux distributions.</p>
<p>There are several solutions to this problem:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/AppImage/AppImageKit/tree/stable/v1.0/LibcWrapGenerator">LibcWrapGenerator</a></li>
<li><a class="reference external" href="https://github.com/wheybags/glibc_version_header">glibc_version_header</a></li>
<li><a class="reference external" href="https://github.com/sulix/bingcc">bingcc</a></li>
</ul>
<p>Some people also advice to use static of glibc, but it’s strongly discouraged. One of the reasons is that newer glibc  might be using
syscalls that are not available in the previous versions, so it will randomly fail in runtime, which is much harder to debug (the situation
about system calls is described below).</p>
<p>It’s possible to model either <code class="docutils literal notranslate"><span class="pre">glibc</span></code> version or Linux distribution name in Conan by defining custom Conan sub-setting in the
<em>settings.yml</em> file (check out sections <a class="reference internal" href="../extending/custom_settings.html#add-new-settings"><span class="std std-ref">Adding new settings</span></a> and <a class="reference internal" href="../extending/custom_settings.html#add-new-sub-settings"><span class="std std-ref">Adding new sub-settings</span></a>). The process will be similar to:</p>
<ul class="simple">
<li>Define new sub-setting, for instance <cite>os.distro</cite>, as explained in the section <a class="reference internal" href="../extending/custom_settings.html#add-new-sub-settings"><span class="std std-ref">Adding new sub-settings</span></a>.</li>
<li>Define compatibility mode, as explained by sections <a class="reference internal" href="../reference/conanfile/methods.html#method-package-id"><span class="std std-ref">package_id()</span></a> and <a class="reference internal" href="../reference/conanfile/methods.html#method-build-id"><span class="std std-ref">build_id()</span></a> (e.g. you may consider some <code class="docutils literal notranslate"><span class="pre">Ubuntu</span></code> and <code class="docutils literal notranslate"><span class="pre">Debian</span></code> packages to be compatible with each other)</li>
<li>Generate different packages for each distribution.</li>
<li>Generate deployable artifacts for each distribution.</li>
</ul>
</div>
<div class="section" id="c-standard-library">
<h4>C++ standard library<a class="headerlink" href="#c-standard-library" title="Permalink to this headline">¶</a></h4>
<p>Usually, the default C++ standard library is <a class="reference external" href="https://gcc.gnu.org/onlinedocs/libstdc++/">libstdc++</a>, but
<a class="reference external" href="https://libcxx.llvm.org/">libc++</a> and <a class="reference external" href="http://www.stlport.org/">stlport</a> are other well-known implementations.</p>
<p>Similarly to the standard C library <cite>glibc</cite>, running the application linked with libstdc++ in the older system may result in an error:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> /hello
<span class="go">/hello: /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21&#39; not found (required by /hello)</span>
<span class="go">/hello: /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.26&#39; not found (required by /hello)</span>
</pre></div>
</div>
<p>Fortunately, this is much easier to address by just adding <code class="docutils literal notranslate"><span class="pre">-static-libstdc++</span></code> compiler flag. Unlike C runtime, C++ runtime can be
linked statically safely, because it doesn’t use system calls directly, but instead relies on <code class="docutils literal notranslate"><span class="pre">libc</span></code> to provide required wrappers.</p>
</div>
<div class="section" id="compiler-runtime">
<h4>Compiler runtime<a class="headerlink" href="#compiler-runtime" title="Permalink to this headline">¶</a></h4>
<p>Besides C and C++ runtime libraries, the compiler runtime libraries are also used by applications. Those libraries usually provide
lower-level functions, such as compiler intrinsics or support for exception handling. Functions from these runtime libraries are rarely
referenced directly in code and are mostly implicitly inserted by the compiler itself.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ldd ./a.out
<span class="go">libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f6626aee000)</span>
</pre></div>
</div>
<p>you can avoid this kind of dependency by the using of the <code class="docutils literal notranslate"><span class="pre">-static-libgcc</span></code> compiler flag. However, it’s not always sane thing to do, as
there are certain situations when applications should use shared runtime. The most common is when the application wishes to throw and catch
exceptions across different shared libraries. Check out the <a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html">GCC manual</a> for the
detailed information.</p>
</div>
<div class="section" id="system-api-system-calls">
<h4>System API (system calls)<a class="headerlink" href="#system-api-system-calls" title="Permalink to this headline">¶</a></h4>
<p>New system calls are often introduced with new releases of <a class="reference external" href="https://www.kernel.org/">Linux kernel</a>. If the application, or 3rd-party
libraries, want to take advantage of these new features, they sometimes directly refer to such system calls (instead of using wrappers
provided by <code class="docutils literal notranslate"><span class="pre">glibc</span></code>).</p>
<p>As a result, if the application was compiled on a machine with a newer kernel and build system used to auto-detect available system calls,
it may fail to execute properly on machines with older kernels.</p>
<p>The solution is to either use a build machine with lowest supported kernel, or model supported operation system (just like in case of <code class="docutils literal notranslate"><span class="pre">glibc</span></code>).
Check out sections <a class="reference internal" href="../extending/custom_settings.html#add-new-settings"><span class="std std-ref">Adding new settings</span></a> and <a class="reference internal" href="../extending/custom_settings.html#add-new-sub-settings"><span class="std std-ref">Adding new sub-settings</span></a> to get a piece of information on how to model distribution in conan settings.</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_installer_packages.html" class="btn btn-neutral float-right" title="Creating conan packages to install dev tools" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../devtools.html" class="btn btn-neutral" title="Package apps and devtools" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, JFrog.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 1.22
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          
            <dd><a href="/en/latest/index.html">1.25</a></dd>
          
        
          
            <dd><a href="/en/1.24/index.html">1.24</a></dd>
          
        
          
            <dd><a href="/en/1.23/index.html">1.23</a></dd>
          
        
          
            <dd><a href="/en/1.22/index.html">1.22</a></dd>
          
        
          
            <dd><a href="/en/1.21/index.html">1.21</a></dd>
          
        
          
            <dd><a href="/en/1.20/index.html">1.20</a></dd>
          
        
          
            <dd><a href="/en/1.19/index.html">1.19</a></dd>
          
        
          
            <dd><a href="/en/1.18/index.html">1.18</a></dd>
          
        
          
            <dd><a href="/en/1.17/index.html">1.17</a></dd>
          
        
          
            <dd><a href="/en/1.16/index.html">1.16</a></dd>
          
        
          
            <dd><a href="/en/1.15/index.html">1.15</a></dd>
          
        
          
            <dd><a href="/en/1.14/index.html">1.14</a></dd>
          
        
          
            <dd><a href="/en/1.13/index.html">1.13</a></dd>
          
        
          
            <dd><a href="/en/1.12/index.html">1.12</a></dd>
          
        
          
            <dd><a href="/en/1.11/index.html">1.11</a></dd>
          
        
          
            <dd><a href="/en/1.10/index.html">1.10</a></dd>
          
        
          
            <dd><a href="/en/1.9/index.html">1.9</a></dd>
          
        
          
            <dd><a href="/en/1.8/index.html">1.8</a></dd>
          
        
          
            <dd><a href="/en/1.7/index.html">1.7</a></dd>
          
        
          
            <dd><a href="/en/1.6/index.html">1.6</a></dd>
          
        
          
            <dd><a href="/en/1.5/index.html">1.5</a></dd>
          
        
          
            <dd><a href="/en/1.4/index.html">1.4</a></dd>
          
        
          
            <dd><a href="/en/1.3/index.html">1.3</a></dd>
          
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="/en/1.22/conan.pdf">PDF</a></dd>
        
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.22.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../_static/js/modernizr.min.js"></script>
  <script src="../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("1.22");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>